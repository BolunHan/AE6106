<!DOCTYPE html><html><head>
      <title>assignment_3</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:///c:\Users\Bolun\.vscode\extensions\shd101wyy.markdown-preview-enhanced-0.8.7\crossnote\dependencies\katex\katex.min.css">
      
      
      
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<div class="md-toc">
<details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#question-1" class="md-toc-link"><p>Question 1</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#1a" class="md-toc-link">
            <p>1.a</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#1b" class="md-toc-link">
            <p>1.b</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#1c" class="md-toc-link">
            <p>1.c</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#1d" class="md-toc-link">
            <p>1.d</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#1e" class="md-toc-link">
            <p>1.e</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#1f" class="md-toc-link">
            <p>1.f</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:18px">
          <a href="#question-2" class="md-toc-link">
            <p>Question 2</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:18px">
          <a href="#question-3" class="md-toc-link">
            <p>Question 3</p>

          </a></div><details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#question-4" class="md-toc-link"><p>Question 4</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#4a" class="md-toc-link"><p>4.a</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#4a0---data-summary" class="md-toc-link">
            <p>4.a.0 - Data Summary</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#4a1---standardization" class="md-toc-link">
            <p>4.a.1 - Standardization</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#4a2---modeling" class="md-toc-link"><p>4.a.2 - Modeling</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#baseline-no-model-naive" class="md-toc-link">
            <p>Baseline: No Model (naive)</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#linear-linear-probability-model" class="md-toc-link">
            <p>Linear: Linear Probability Model</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#linear-logistic-probability-model" class="md-toc-link">
            <p>Linear: Logistic Probability Model</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#linear-logistic-probability-model-modified" class="md-toc-link">
            <p>Linear: Logistic Probability Model, Modified</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#linear-qda" class="md-toc-link">
            <p>Linear: QDA</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#random-forest" class="md-toc-link">
            <p>Random Forest</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#svm" class="md-toc-link">
            <p>SVM</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#knn" class="md-toc-link">
            <p>KNN</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#bagged-svm" class="md-toc-link">
            <p>Bagged: SVM</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#bagged-linear-logistic-model" class="md-toc-link">
            <p>Bagged: linear logistic model</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#summary" class="md-toc-link">
            <p>Summary</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#4b" class="md-toc-link"><p>4.b</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#0-features-of-the-data" class="md-toc-link">
            <ol start="0">
<li>Features of the Data</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#1-noise-handling" class="md-toc-link">
            <ol>
<li>Noise Handling</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#2-non-linear-features" class="md-toc-link">
            <ol start="2">
<li>Non-linear Features</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#3-fitting" class="md-toc-link">
            <ol start="3">
<li>Fitting</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#4-optional-augmentation" class="md-toc-link">
            <ol start="4">
<li>Optional: Augmentation</li>
</ol>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#4c" class="md-toc-link">
            <p>4.c</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:18px">
          <a href="#appendix" class="md-toc-link">
            <p>Appendix</p>

          </a></div>
</div>
<h1 id="question-1">Question 1 </h1>
<h2 id="1a">1.a </h2>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code>library<span class="token punctuation">(</span>readxl<span class="token punctuation">)</span>
admission <span class="token operator">&lt;-</span> read_excel<span class="token punctuation">(</span><span class="token string">"Downloads/admission.xlsx"</span><span class="token punctuation">)</span>
library<span class="token punctuation">(</span>GGally<span class="token punctuation">)</span>
library<span class="token punctuation">(</span>ggplot2<span class="token punctuation">)</span>
ggpairs<span class="token punctuation">(</span>admission<span class="token punctuation">,</span> columns <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"gre"</span><span class="token punctuation">,</span> <span class="token string">"gpa"</span><span class="token punctuation">,</span> <span class="token string">"rank"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><p><img src="plot_zoom_png.png" alt="Alt text"></p>
<p>Features relationships</p>
<ul>
<li>the <em>GPA</em> and <em>GRE</em> are significantly positive correlated.
<ul>
<li>This is natural, since both feature is a metrics of applicant's ability.</li>
</ul>
</li>
<li>The <em>rank</em> shows some positive correlation with <em>GRE</em>.
<ul>
<li>Since applicants with better ability usually end up in better schools, this is also reasonable.</li>
</ul>
</li>
<li>The <em>rank</em> shows no correlation with <em>GPA</em>.
<ul>
<li>The applicants' <em>GPA</em> is graded by individual institutions, and lack the ability to make horizontal (cross-institution) comparisons.</li>
</ul>
</li>
</ul>
<h2 id="1b">1.b </h2>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code>library<span class="token punctuation">(</span>dplyr<span class="token punctuation">)</span>
summarise<span class="token punctuation">(</span>group_by<span class="token punctuation">(</span>admission<span class="token punctuation">,</span> rank<span class="token punctuation">)</span><span class="token punctuation">,</span> mean<span class="token punctuation">(</span>gpa<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><p>The results are shown as followed:</p>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code><span class="token comment"># A tibble: 4 × 2</span>
   rank `mean<span class="token punctuation">(</span>gpa<span class="token punctuation">)</span>`
  <span class="token operator">&lt;</span>dbl<span class="token operator">&gt;</span>       <span class="token operator">&lt;</span>dbl<span class="token operator">&gt;</span>
<span class="token number">1</span>     <span class="token number">1</span>        <span class="token number">3.45</span>
<span class="token number">2</span>     <span class="token number">2</span>        <span class="token number">3.36</span>
<span class="token number">3</span>     <span class="token number">3</span>        <span class="token number">3.43</span>
<span class="token number">4</span>     <span class="token number">4</span>        <span class="token number">3.32</span>
</code></pre><h2 id="1c">1.c </h2>
<p>The percentage of applications accepted is the mean of <em>admit</em></p>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code>summarise<span class="token punctuation">(</span>group_by<span class="token punctuation">(</span>admission<span class="token punctuation">,</span> rank<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"percentage of admitted in %"</span> <span class="token operator">=</span> mean<span class="token punctuation">(</span>admit<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span>
</code></pre><p>The results are:</p>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code>   rank `percentage of admitted <span class="token keyword keyword-in">in</span> %`
  <span class="token operator">&lt;</span>dbl<span class="token operator">&gt;</span>                         <span class="token operator">&lt;</span>dbl<span class="token operator">&gt;</span>
<span class="token number">1</span>     <span class="token number">1</span>                          <span class="token number">54.1</span>
<span class="token number">2</span>     <span class="token number">2</span>                          <span class="token number">35.8</span>
<span class="token number">3</span>     <span class="token number">3</span>                          <span class="token number">23.1</span>
<span class="token number">4</span>     <span class="token number">4</span>                          <span class="token number">17.9</span>
</code></pre><h2 id="1d">1.d </h2>
<p>Now we build the tree, without considering over-fitting issue, using <code>rpart</code></p>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code>library<span class="token punctuation">(</span>rpart<span class="token punctuation">)</span>
library<span class="token punctuation">(</span>rpart.plot<span class="token punctuation">)</span>
set.seed<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>
<span class="token comment"># admission$admit &lt;- as.factor(admission$admit)</span>
tree <span class="token operator">&lt;-</span> rpart<span class="token punctuation">(</span>formula <span class="token operator">=</span> admit <span class="token operator">~</span> gpa <span class="token operator">+</span> gre <span class="token operator">+</span> rank<span class="token punctuation">,</span> data <span class="token operator">=</span> admission<span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token string">"class"</span><span class="token punctuation">)</span>
rpart.plot<span class="token punctuation">(</span>tree<span class="token punctuation">)</span>
</code></pre><p><img src="plot_zoom_png-1.png" alt="Alt text"></p>
<p>Decision tree with 8 branches (splits) and 4 layers of structure.</p>
<ul>
<li>Forked based on <code>GPA &lt;= 3.4</code>.</li>
<li>Low <em>GPA</em> group is forked based on <code>rank &gt;= 3</code>.
<ul>
<li>High <em>rank</em> group then forked based on <code>gre &lt; 730</code>.</li>
</ul>
</li>
<li>High gpa group do multiple forking based on <code>rank &gt;= 2</code> and <code>rank &gt;= 3</code>.
<ul>
<li>then <code>3 &gt;= rank &gt;= 2</code> do multiple forking based on <code>gpa &gt;= 3.5</code> and <code>gpa &lt; 3.7</code>.</li>
</ul>
</li>
<li>AT each leaf node, calculate the probability of <em>admit</em>, and make classification based on this.</li>
</ul>
<h2 id="1e">1.e </h2>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code><span class="token operator">&gt;</span> printcp<span class="token punctuation">(</span>tree<span class="token punctuation">)</span>

Classification tree<span class="token operator">:</span>
rpart<span class="token punctuation">(</span>formula <span class="token operator">=</span> admit <span class="token operator">~</span> gpa <span class="token operator">+</span> gre <span class="token operator">+</span> rank<span class="token punctuation">,</span> data <span class="token operator">=</span> admission<span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token string">"class"</span><span class="token punctuation">)</span>

Variables actually used <span class="token keyword keyword-in">in</span> tree construction<span class="token operator">:</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> gpa  gre  rank

Root node error<span class="token operator">:</span> <span class="token number">127</span><span class="token operator">/</span><span class="token number">400</span> <span class="token operator">=</span> <span class="token number">0.3175</span>

n<span class="token operator">=</span> <span class="token number">400</span> 

        CP nsplit rel error  xerror     xstd
<span class="token number">1</span> <span class="token number">0.062992</span>      <span class="token number">0</span>   <span class="token number">1.00000</span> <span class="token number">1.00000</span> <span class="token number">0.073308</span>
<span class="token number">2</span> <span class="token number">0.023622</span>      <span class="token number">2</span>   <span class="token number">0.87402</span> <span class="token number">0.95276</span> <span class="token number">0.072337</span>
<span class="token number">3</span> <span class="token number">0.015748</span>      <span class="token number">4</span>   <span class="token number">0.82677</span> <span class="token number">0.96063</span> <span class="token number">0.072505</span>
<span class="token number">4</span> <span class="token number">0.010000</span>      <span class="token number">8</span>   <span class="token number">0.76378</span> <span class="token number">1.00000</span> <span class="token number">0.073308</span>
</code></pre><p>The results above shows that:</p>
<ul>
<li>at initial value <code>cp = 0.01</code>, the tree having 8 splits and with a cross-validation error <code>1.0 * 0.3175</code></li>
<li>at <code>cp = 0.015748</code>, the tree reduced to 4 splits and with a cross-validation error <code>0.96063 * 0.3175</code></li>
<li>at <code>cp = 0.023622</code>, the tree reduced to 2 splits and with a cross-validation error <code>0.95276 * 0.3175</code></li>
<li>at <code>cp = 0.062992</code>, the tree has no split, which gives little info other than the average.</li>
</ul>
<p>The best scenario is <code>cp = 0.023622</code>, which gives the least cross-validation error. Rebuild the tree with the given parameters gives us</p>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code>tree.pruned <span class="token operator">&lt;-</span> prune<span class="token punctuation">(</span>tree<span class="token punctuation">,</span> cp <span class="token operator">=</span> <span class="token number">0.023622</span><span class="token punctuation">)</span>
</code></pre><p>The new tree is</p>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code>rpart.plot<span class="token punctuation">(</span>tree.pruned<span class="token punctuation">)</span>
</code></pre><p><img src="plot_zoom_png-2.png" alt="Alt text"></p>
<p>Note, that after complexity regularization, the tree left with only 2 split and 5 leaf nodes.</p>
<h2 id="1f">1.f </h2>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code><span class="token operator">&gt;</span> predict<span class="token punctuation">(</span>tree.pruned<span class="token punctuation">,</span> list<span class="token punctuation">(</span>gpa <span class="token operator">=</span> <span class="token number">3.2</span><span class="token punctuation">,</span> gre <span class="token operator">=</span> <span class="token number">530</span><span class="token punctuation">,</span> rank <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token number">0</span>         <span class="token number">1</span>
<span class="token number">1</span> <span class="token number">0.7836538</span> <span class="token number">0.2163462</span>
</code></pre><p>Thus, the applicant should be rejected.</p>
<h1 id="question-2">Question 2 </h1>
<ol>
<li>Step 1. Standardize the Training Set</li>
</ol>
<p>with min-max standardization</p>
<table>
<thead>
<tr>
<th>Age</th>
<th>Inc</th>
<th>Educ</th>
</tr>
</thead>
<tbody>
<tr>
<td>0.806</td>
<td>1.000</td>
<td>1.000</td>
</tr>
<tr>
<td>0.611</td>
<td>0.336</td>
<td>0.375</td>
</tr>
<tr>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
</tr>
<tr>
<td>0.389</td>
<td>0.404</td>
<td>0.125</td>
</tr>
<tr>
<td>1.000</td>
<td>0.301</td>
<td>0.375</td>
</tr>
<tr>
<td>0.056</td>
<td>0.233</td>
<td>0.875</td>
</tr>
</tbody>
</table>
<ol start="2">
<li>Step 2. Calculate the Distance</li>
</ol>
<p>We use Euclidean distance.</p>
<table>
<thead>
<tr>
<th>Idx</th>
<th>Age</th>
<th>Inc</th>
<th>Educ</th>
<th>Default</th>
<th>Dis</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>0.806</td>
<td>1.000</td>
<td>1.000</td>
<td>0</td>
<td>0.494</td>
</tr>
<tr>
<td>2</td>
<td>0.611</td>
<td>0.336</td>
<td>0.375</td>
<td>0</td>
<td>0.073</td>
</tr>
<tr>
<td>3</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>1</td>
<td>0.956</td>
</tr>
<tr>
<td>4</td>
<td>0.389</td>
<td>0.404</td>
<td>0.125</td>
<td>1</td>
<td>0.301</td>
</tr>
<tr>
<td>5</td>
<td>1.000</td>
<td>0.301</td>
<td>0.375</td>
<td>0</td>
<td>0.232</td>
</tr>
<tr>
<td>6</td>
<td>0.056</td>
<td>0.233</td>
<td>0.875</td>
<td>1</td>
<td>0.413</td>
</tr>
</tbody>
</table>
<ol start="3">
<li>Step 3. Find Nearest Neighbor</li>
</ol>
<p>The 3-nearest neighbors are #2, #5 and #4, the majority is non-default.</p>
<p>Thus our conclusion is that he/she will <strong>NOT</strong> default.</p>
<h1 id="question-3">Question 3 </h1>
<ol>
<li>for <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mn>1</mn><mo stretchy="false">(</mo><mtext>Gender</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">X1 (\text{Gender})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mord">1</span><span class="mopen">(</span><span class="mord text"><span class="mord">Gender</span></span><span class="mclose">)</span></span></span></span></li>
</ol>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left right left" columnspacing="0em 1em 0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>G</mi><mo stretchy="false">(</mo><mtext>Gender</mtext><mo separator="true">,</mo><mtext>Male</mtext><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mn>1</mn><mo>−</mo><msup><mrow><mo fence="true">(</mo><mfrac><mn>2</mn><mn>4</mn></mfrac><mo fence="true">)</mo></mrow><mn>2</mn></msup><mo>−</mo><msup><mrow><mo fence="true">(</mo><mfrac><mn>2</mn><mn>4</mn></mfrac><mo fence="true">)</mo></mrow><mn>2</mn></msup></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>G</mi><mo stretchy="false">(</mo><mtext>Gender</mtext><mo separator="true">,</mo><mtext>Female</mtext><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mn>1</mn><mo>−</mo><msup><mrow><mo fence="true">(</mo><mfrac><mn>2</mn><mn>4</mn></mfrac><mo fence="true">)</mo></mrow><mn>2</mn></msup><mo>−</mo><msup><mrow><mo fence="true">(</mo><mfrac><mn>2</mn><mn>4</mn></mfrac><mo fence="true">)</mo></mrow><mn>2</mn></msup></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>G</mi><mo stretchy="false">(</mo><mtext>Gender</mtext><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mfrac><mn>4</mn><mn>8</mn></mfrac><mo>×</mo><mi>G</mi><mo stretchy="false">(</mo><mtext>Gender</mtext><mo separator="true">,</mo><mtext>Male</mtext><mo stretchy="false">)</mo><mo>+</mo><mfrac><mn>4</mn><mn>8</mn></mfrac><mo>×</mo><mi>G</mi><mo stretchy="false">(</mo><mtext>Gender</mtext><mo separator="true">,</mo><mtext>Female</mtext><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo>=</mo><mn>0.5</mn></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
G(\text{Gender}, \text{Male}) &amp;= 1 - \left(\frac{2}{4}\right)^2 - \left(\frac{2}{4}\right)^2 &amp;&amp;= \frac{1}{2} \\
G(\text{Gender}, \text{Female}) &amp;= 1 - \left(\frac{2}{4}\right)^2 - \left(\frac{2}{4}\right)^2 &amp;&amp;= \frac{1}{2} \\
G(\text{Gender}) &amp;= \frac{4}{8} \times G(\text{Gender}, \text{Male}) + \frac{4}{8} \times G(\text{Gender}, \text{Female}) &amp;&amp;= \frac{1}{2} = 0.5
\end{align*}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:8.1155em;vertical-align:-3.8078em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.3078em;"><span style="top:-6.3078em;"><span class="pstrut" style="height:3.654em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="mopen">(</span><span class="mord text"><span class="mord">Gender</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord text"><span class="mord">Male</span></span><span class="mclose">)</span></span></span><span style="top:-3.4037em;"><span class="pstrut" style="height:3.654em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="mopen">(</span><span class="mord text"><span class="mord">Gender</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord text"><span class="mord">Female</span></span><span class="mclose">)</span></span></span><span style="top:-0.8322em;"><span class="pstrut" style="height:3.654em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="mopen">(</span><span class="mord text"><span class="mord">Gender</span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.8078em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.3078em;"><span style="top:-6.3078em;"><span class="pstrut" style="height:3.654em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">4</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.654em;"><span style="top:-3.9029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">4</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.654em;"><span style="top:-3.9029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.4037em;"><span class="pstrut" style="height:3.654em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">4</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.654em;"><span style="top:-3.9029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">4</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.654em;"><span style="top:-3.9029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-0.8322em;"><span class="pstrut" style="height:3.654em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">8</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">G</span><span class="mopen">(</span><span class="mord text"><span class="mord">Gender</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord text"><span class="mord">Male</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">8</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">G</span><span class="mopen">(</span><span class="mord text"><span class="mord">Gender</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord text"><span class="mord">Female</span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.8078em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.3078em;"><span style="top:-6.3078em;"><span class="pstrut" style="height:3.654em;"></span><span class="mord"></span></span><span style="top:-3.4037em;"><span class="pstrut" style="height:3.654em;"></span><span class="mord"></span></span><span style="top:-0.8322em;"><span class="pstrut" style="height:3.654em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.8078em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.3078em;"><span style="top:-6.3078em;"><span class="pstrut" style="height:3.654em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-3.4037em;"><span class="pstrut" style="height:3.654em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-0.8322em;"><span class="pstrut" style="height:3.654em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">0.5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.8078em;"><span></span></span></span></span></span></span></span></span></span></span></span></p>
<ol start="2">
<li>for <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mn>2</mn><mo stretchy="false">(</mo><mtext>Education</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">X2 (\text{Education})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mord">2</span><span class="mopen">(</span><span class="mord text"><span class="mord">Education</span></span><span class="mclose">)</span></span></span></span></li>
</ol>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left right left" columnspacing="0em 1em 0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>G</mi><mo stretchy="false">(</mo><mtext>Education</mtext><mo separator="true">,</mo><mtext>No&nbsp;formal&nbsp;education</mtext><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mn>1</mn><mo>−</mo><msup><mrow><mo fence="true">(</mo><mfrac><mn>0</mn><mn>2</mn></mfrac><mo fence="true">)</mo></mrow><mn>2</mn></msup><mo>−</mo><msup><mrow><mo fence="true">(</mo><mfrac><mn>2</mn><mn>2</mn></mfrac><mo fence="true">)</mo></mrow><mn>2</mn></msup></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mn>0</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>G</mi><mo stretchy="false">(</mo><mtext>Education</mtext><mo separator="true">,</mo><mtext>Degree</mtext><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mn>1</mn><mo>−</mo><msup><mrow><mo fence="true">(</mo><mfrac><mn>3</mn><mn>4</mn></mfrac><mo fence="true">)</mo></mrow><mn>2</mn></msup><mo>−</mo><msup><mrow><mo fence="true">(</mo><mfrac><mn>1</mn><mn>4</mn></mfrac><mo fence="true">)</mo></mrow><mn>2</mn></msup></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mfrac><mn>3</mn><mn>8</mn></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>G</mi><mo stretchy="false">(</mo><mtext>Education</mtext><mo separator="true">,</mo><mtext>Secondary</mtext><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mn>1</mn><mo>−</mo><msup><mrow><mo fence="true">(</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo fence="true">)</mo></mrow><mn>2</mn></msup><mo>−</mo><msup><mrow><mo fence="true">(</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo fence="true">)</mo></mrow><mn>2</mn></msup></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>G</mi><mo stretchy="false">(</mo><mtext>Gender</mtext><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mfrac><mn>2</mn><mn>8</mn></mfrac><mo>×</mo><mn>0</mn><mo>+</mo><mfrac><mn>4</mn><mn>8</mn></mfrac><mo>×</mo><mfrac><mn>3</mn><mn>8</mn></mfrac><mo>+</mo><mfrac><mn>2</mn><mn>8</mn></mfrac><mo>×</mo><mfrac><mn>1</mn><mn>2</mn></mfrac></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mfrac><mn>5</mn><mn>16</mn></mfrac><mo>=</mo><mn>0.3125</mn></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
G(\text{Education}, \text{No formal education}) &amp;= 1 - \left(\frac{0}{2}\right)^2 - \left(\frac{2}{2}\right)^2 &amp;&amp;= 0 \\
G(\text{Education}, \text{Degree}) &amp;= 1 - \left(\frac{3}{4}\right)^2 - \left(\frac{1}{4}\right)^2 &amp;&amp;= \frac{3}{8} \\
G(\text{Education}, \text{Secondary}) &amp;= 1 - \left(\frac{1}{2}\right)^2 - \left(\frac{1}{2}\right)^2 &amp;&amp;= \frac{1}{2} \\
G(\text{Gender}) &amp;= \frac{2}{8} \times 0 + \frac{4}{8} \times \frac{3}{8} + \frac{2}{8} \times \frac{1}{2} &amp;&amp;= \frac{5}{16} = 0.3125
\end{align*}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:11.0196em;vertical-align:-5.2598em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:5.7598em;"><span style="top:-7.7598em;"><span class="pstrut" style="height:3.654em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="mopen">(</span><span class="mord text"><span class="mord">Education</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord text"><span class="mord">No&nbsp;formal&nbsp;education</span></span><span class="mclose">)</span></span></span><span style="top:-4.8557em;"><span class="pstrut" style="height:3.654em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="mopen">(</span><span class="mord text"><span class="mord">Education</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord text"><span class="mord">Degree</span></span><span class="mclose">)</span></span></span><span style="top:-1.9517em;"><span class="pstrut" style="height:3.654em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="mopen">(</span><span class="mord text"><span class="mord">Education</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord text"><span class="mord">Secondary</span></span><span class="mclose">)</span></span></span><span style="top:0.6198em;"><span class="pstrut" style="height:3.654em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="mopen">(</span><span class="mord text"><span class="mord">Gender</span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:5.2598em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:5.7598em;"><span style="top:-7.7598em;"><span class="pstrut" style="height:3.654em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.654em;"><span style="top:-3.9029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.654em;"><span style="top:-3.9029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-4.8557em;"><span class="pstrut" style="height:3.654em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">4</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.654em;"><span style="top:-3.9029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">4</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.654em;"><span style="top:-3.9029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-1.9517em;"><span class="pstrut" style="height:3.654em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.654em;"><span style="top:-3.9029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.654em;"><span style="top:-3.9029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:0.6198em;"><span class="pstrut" style="height:3.654em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">8</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">8</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">8</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">8</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:5.2598em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:5.7598em;"><span style="top:-7.7598em;"><span class="pstrut" style="height:3.654em;"></span><span class="mord"></span></span><span style="top:-4.8557em;"><span class="pstrut" style="height:3.654em;"></span><span class="mord"></span></span><span style="top:-1.9517em;"><span class="pstrut" style="height:3.654em;"></span><span class="mord"></span></span><span style="top:0.6198em;"><span class="pstrut" style="height:3.654em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:5.2598em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:5.7598em;"><span style="top:-7.7598em;"><span class="pstrut" style="height:3.654em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">0</span></span></span><span style="top:-4.8557em;"><span class="pstrut" style="height:3.654em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">8</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-1.9517em;"><span class="pstrut" style="height:3.654em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:0.6198em;"><span class="pstrut" style="height:3.654em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">16</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">0.3125</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:5.2598em;"><span></span></span></span></span></span></span></span></span></span></span></span></p>
<ol start="3">
<li>for <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mn>3</mn><mo stretchy="false">(</mo><mtext>Place</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">X3 (\text{Place})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mord">3</span><span class="mopen">(</span><span class="mord text"><span class="mord">Place</span></span><span class="mclose">)</span></span></span></span></li>
</ol>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left right left" columnspacing="0em 1em 0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>G</mi><mo stretchy="false">(</mo><mtext>Place</mtext><mo separator="true">,</mo><mtext>Suburban</mtext><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mn>1</mn><mo>−</mo><msup><mrow><mo fence="true">(</mo><mfrac><mn>2</mn><mn>3</mn></mfrac><mo fence="true">)</mo></mrow><mn>2</mn></msup><mo>−</mo><msup><mrow><mo fence="true">(</mo><mfrac><mn>1</mn><mn>3</mn></mfrac><mo fence="true">)</mo></mrow><mn>2</mn></msup></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mfrac><mn>4</mn><mn>9</mn></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>G</mi><mo stretchy="false">(</mo><mtext>Place</mtext><mo separator="true">,</mo><mtext>Urban</mtext><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mn>1</mn><mo>−</mo><msup><mrow><mo fence="true">(</mo><mfrac><mn>2</mn><mn>5</mn></mfrac><mo fence="true">)</mo></mrow><mn>2</mn></msup><mo>−</mo><msup><mrow><mo fence="true">(</mo><mfrac><mn>3</mn><mn>5</mn></mfrac><mo fence="true">)</mo></mrow><mn>2</mn></msup></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mfrac><mn>12</mn><mn>25</mn></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>G</mi><mo stretchy="false">(</mo><mtext>Place</mtext><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mfrac><mn>3</mn><mn>8</mn></mfrac><mo>×</mo><mfrac><mn>4</mn><mn>9</mn></mfrac><mo>+</mo><mfrac><mn>5</mn><mn>8</mn></mfrac><mo>×</mo><mfrac><mn>12</mn><mn>25</mn></mfrac></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mfrac><mn>7</mn><mn>15</mn></mfrac><mo>=</mo><mn>0.4667</mn></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
G(\text{Place}, \text{Suburban}) &amp;= 1 - \left(\frac{2}{3}\right)^2 - \left(\frac{1}{3}\right)^2 &amp;&amp;= \frac{4}{9} \\
G(\text{Place}, \text{Urban}) &amp;= 1 - \left(\frac{2}{5}\right)^2 - \left(\frac{3}{5}\right)^2 &amp;&amp;= \frac{12}{25} \\
G(\text{Place}) &amp;= \frac{3}{8} \times \frac{4}{9} + \frac{5}{8} \times \frac{12}{25} &amp;&amp;= \frac{7}{15} = 0.4667
\end{align*}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:8.1155em;vertical-align:-3.8078em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.3078em;"><span style="top:-6.3078em;"><span class="pstrut" style="height:3.654em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="mopen">(</span><span class="mord text"><span class="mord">Place</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord text"><span class="mord">Suburban</span></span><span class="mclose">)</span></span></span><span style="top:-3.4037em;"><span class="pstrut" style="height:3.654em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="mopen">(</span><span class="mord text"><span class="mord">Place</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord text"><span class="mord">Urban</span></span><span class="mclose">)</span></span></span><span style="top:-0.8322em;"><span class="pstrut" style="height:3.654em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="mopen">(</span><span class="mord text"><span class="mord">Place</span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.8078em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.3078em;"><span style="top:-6.3078em;"><span class="pstrut" style="height:3.654em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">3</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.654em;"><span style="top:-3.9029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">3</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.654em;"><span style="top:-3.9029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.4037em;"><span class="pstrut" style="height:3.654em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">5</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.654em;"><span style="top:-3.9029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">5</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.654em;"><span style="top:-3.9029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-0.8322em;"><span class="pstrut" style="height:3.654em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">8</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">9</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">8</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">25</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">12</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.8078em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.3078em;"><span style="top:-6.3078em;"><span class="pstrut" style="height:3.654em;"></span><span class="mord"></span></span><span style="top:-3.4037em;"><span class="pstrut" style="height:3.654em;"></span><span class="mord"></span></span><span style="top:-0.8322em;"><span class="pstrut" style="height:3.654em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.8078em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.3078em;"><span style="top:-6.3078em;"><span class="pstrut" style="height:3.654em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">9</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-3.4037em;"><span class="pstrut" style="height:3.654em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">25</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">12</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-0.8322em;"><span class="pstrut" style="height:3.654em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">15</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">7</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">0.4667</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.8078em;"><span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>The <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mn>2</mn><mo stretchy="false">(</mo><mtext>Education</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">X2 (\text{Education})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mord">2</span><span class="mopen">(</span><span class="mord text"><span class="mord">Education</span></span><span class="mclose">)</span></span></span></span> having the lowest Gini index, thus should be used as the first internal node.</p>
<p>the node we propose is that</p>
<ul>
<li>Degree -&gt; Single</li>
<li>Otherwise -&gt; Married</li>
</ul>
<p>This misclassification rate is 25%</p>
<h1 id="question-4">Question 4 </h1>
<h2 id="4a">4.a </h2>
<h3 id="4a0---data-summary">4.a.0 - Data Summary </h3>
<p>Before we do any modeling, we should conduct some descriptive statistics to determine the baseline.</p>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code><span class="token operator">&gt;</span> library<span class="token punctuation">(</span>skimr<span class="token punctuation">)</span>
<span class="token operator">&gt;</span> statistics <span class="token operator">&lt;-</span> skim<span class="token punctuation">(</span>Stock_2018<span class="token punctuation">)</span>
</code></pre><p>We print the result in html, and extract the tables, some columns are removed for better readability.</p>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code>knit_print<span class="token punctuation">(</span>statistics<span class="token punctuation">)</span>
</code></pre><p>The results are shown as followed</p>
<p><strong>Data summary</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Stock_2018</th>
</tr>
</thead>
<tbody>
<tr>
<td>Number of rows</td>
<td>4392</td>
</tr>
<tr>
<td>Number of columns</td>
<td>15</td>
</tr>
<tr>
<td>_______________________</td>
<td></td>
</tr>
<tr>
<td>Column type frequency:</td>
<td></td>
</tr>
<tr>
<td>character</td>
<td>1</td>
</tr>
<tr>
<td>numeric</td>
<td>14</td>
</tr>
<tr>
<td>________________________</td>
<td></td>
</tr>
<tr>
<td>Group variables</td>
<td>None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table>
<thead>
<tr>
<th>skim_variable</th>
<th>n_missing</th>
<th>complete_rate</th>
<th>min</th>
<th>max</th>
<th>empty</th>
<th>n_unique</th>
<th>whitespace</th>
</tr>
</thead>
<tbody>
<tr>
<td>Company Name</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>5</td>
<td>0</td>
<td>4392</td>
<td>0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead>
<tr>
<th>skim_variable</th>
<th style="text-align:right">n_missing</th>
<th style="text-align:right">mean</th>
<th style="text-align:right">sd</th>
<th style="text-align:right">p0</th>
<th style="text-align:right">p25</th>
<th style="text-align:right">p50</th>
<th style="text-align:right">p75</th>
<th style="text-align:right">p100</th>
</tr>
</thead>
<tbody>
<tr>
<td>Revenue Growth</td>
<td style="text-align:right">139</td>
<td style="text-align:right">3.46</td>
<td style="text-align:right">195.50</td>
<td style="text-align:right">-3.46</td>
<td style="text-align:right">0.00</td>
<td style="text-align:right">0.07</td>
<td style="text-align:right">0.19</td>
<td style="text-align:right">12,739.00</td>
</tr>
<tr>
<td>EPS</td>
<td style="text-align:right">65</td>
<td style="text-align:right">-69.94</td>
<td style="text-align:right">5,718.69</td>
<td style="text-align:right">-359,825.00</td>
<td style="text-align:right">-0.39</td>
<td style="text-align:right">0.69</td>
<td style="text-align:right">2.31</td>
<td style="text-align:right">101,641.00</td>
</tr>
<tr>
<td>Profit Margin</td>
<td style="text-align:right">306</td>
<td style="text-align:right">-8.26</td>
<td style="text-align:right">185.02</td>
<td style="text-align:right">-8,964.92</td>
<td style="text-align:right">-0.05</td>
<td style="text-align:right">0.04</td>
<td style="text-align:right">0.14</td>
<td style="text-align:right">3,090.87</td>
</tr>
<tr>
<td>Net Profit Margin</td>
<td style="text-align:right">176</td>
<td style="text-align:right">-4.82</td>
<td style="text-align:right">103.48</td>
<td style="text-align:right">-5,009.17</td>
<td style="text-align:right">-0.03</td>
<td style="text-align:right">0.05</td>
<td style="text-align:right">0.15</td>
<td style="text-align:right">1,056.47</td>
</tr>
<tr>
<td>dividendYield</td>
<td style="text-align:right">259</td>
<td style="text-align:right">0.26</td>
<td style="text-align:right">6.74</td>
<td style="text-align:right">0.00</td>
<td style="text-align:right">0.00</td>
<td style="text-align:right">0.00</td>
<td style="text-align:right">0.03</td>
<td style="text-align:right">373.13</td>
</tr>
<tr>
<td>returnOnAssets</td>
<td style="text-align:right">1,106</td>
<td style="text-align:right">0.00</td>
<td style="text-align:right">6.69</td>
<td style="text-align:right">-193.68</td>
<td style="text-align:right">-0.17</td>
<td style="text-align:right">0.04</td>
<td style="text-align:right">0.18</td>
<td style="text-align:right">203.46</td>
</tr>
<tr>
<td>returnOnEquity</td>
<td style="text-align:right">256</td>
<td style="text-align:right">2,685.09</td>
<td style="text-align:right">173,237.49</td>
<td style="text-align:right">-34,772.46</td>
<td style="text-align:right">-0.08</td>
<td style="text-align:right">0.07</td>
<td style="text-align:right">0.15</td>
<td style="text-align:right">11,141,141.67</td>
</tr>
<tr>
<td>debtRatio</td>
<td style="text-align:right">251</td>
<td style="text-align:right">0.27</td>
<td style="text-align:right">0.49</td>
<td style="text-align:right">-0.42</td>
<td style="text-align:right">0.04</td>
<td style="text-align:right">0.21</td>
<td style="text-align:right">0.40</td>
<td style="text-align:right">24.36</td>
</tr>
<tr>
<td>PE ratio</td>
<td style="text-align:right">252</td>
<td style="text-align:right">24.04</td>
<td style="text-align:right">105.52</td>
<td style="text-align:right">0.00</td>
<td style="text-align:right">0.00</td>
<td style="text-align:right">10.76</td>
<td style="text-align:right">20.46</td>
<td style="text-align:right">3,842.00</td>
</tr>
<tr>
<td>Dividend Yield</td>
<td style="text-align:right">251</td>
<td style="text-align:right">0.02</td>
<td style="text-align:right">0.11</td>
<td style="text-align:right">0.00</td>
<td style="text-align:right">0.00</td>
<td style="text-align:right">0.00</td>
<td style="text-align:right">0.02</td>
<td style="text-align:right">5.97</td>
</tr>
<tr>
<td>Book Value per Share Growth</td>
<td style="text-align:right">271</td>
<td style="text-align:right">0.26</td>
<td style="text-align:right">5.61</td>
<td style="text-align:right">-32.26</td>
<td style="text-align:right">-0.11</td>
<td style="text-align:right">0.03</td>
<td style="text-align:right">0.14</td>
<td style="text-align:right">313.40</td>
</tr>
<tr>
<td>Debt Growth</td>
<td style="text-align:right">264</td>
<td style="text-align:right">9.93</td>
<td style="text-align:right">363.72</td>
<td style="text-align:right">-1.00</td>
<td style="text-align:right">-0.08</td>
<td style="text-align:right">0.00</td>
<td style="text-align:right">0.12</td>
<td style="text-align:right">17,646.82</td>
</tr>
<tr>
<td>R&amp;D Expense Growth</td>
<td style="text-align:right">259</td>
<td style="text-align:right">0.09</td>
<td style="text-align:right">0.82</td>
<td style="text-align:right">-1.00</td>
<td style="text-align:right">0.00</td>
<td style="text-align:right">0.00</td>
<td style="text-align:right">0.01</td>
<td style="text-align:right">36.90</td>
</tr>
<tr>
<td>y</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0.69</td>
<td style="text-align:right">0.46</td>
<td style="text-align:right">0.00</td>
<td style="text-align:right">0.00</td>
<td style="text-align:right">1.00</td>
<td style="text-align:right">1.00</td>
<td style="text-align:right">1.00</td>
</tr>
</tbody>
</table>
<p>Features of the data:</p>
<ul>
<li>significant outliers
<ul>
<li>making min-max scaling not a good choice</li>
<li>extreme value even affecting sd, z-score scaling is affected</li>
<li>considering dropping these observations in the modeling, or in least at scaling process</li>
</ul>
</li>
<li>contains some missing data
<ul>
<li>after scaling the data</li>
<li>fill na with 0</li>
<li>which means use the "average" of the population</li>
</ul>
</li>
</ul>
<h3 id="4a1---standardization">4.a.1 - Standardization </h3>
<p>The machine learning algos we use in this courses are</p>
<ul>
<li>either not sensitive to the scaling, like LDA, QDA, SVM, Random Forest</li>
<li>or required a proper scaling, like KNN</li>
</ul>
<p>As we demonstrated above, using a simple min-max scaler is not a good choice. We decide to go for a modified z-score</p>
<ul>
<li>for each feature, we remove 5% of the observation for each side (90% obs remaining)</li>
<li>calculating the mean, median and std</li>
<li>use <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi><mo>=</mo><mo stretchy="false">(</mo><mi>v</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mo>−</mo><mi>m</mi><mi>e</mi><mi>a</mi><mi>n</mi><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><mi>s</mi><mi>t</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">z = (value - mean) / std</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">e</span><span class="mord mathnormal">an</span><span class="mclose">)</span><span class="mord">/</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">d</span></span></span></span> to standardize the data (for whole sample)</li>
</ul>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code>trim_percent <span class="token operator">&lt;-</span> <span class="token number">0.1</span>
data.original <span class="token operator">&lt;-</span>  subset<span class="token punctuation">(</span>Stock_2018<span class="token punctuation">,</span> select <span class="token operator">=</span> <span class="token operator">-</span>y<span class="token punctuation">)</span>
data.y <span class="token operator">&lt;-</span> Stock_2018<span class="token operator">$</span>y

trim_limit_bottom <span class="token operator">&lt;-</span> trim_percent <span class="token operator">/</span> <span class="token number">2</span>
trim_limit_top <span class="token operator">&lt;-</span> <span class="token number">1</span> <span class="token operator">-</span> <span class="token punctuation">(</span>trim_percent <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>
statistics.trimmed <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>col_name <span class="token keyword keyword-in">in</span> names<span class="token punctuation">(</span>data.original<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>is.numeric<span class="token punctuation">(</span>data.original<span class="token punctuation">[</span><span class="token punctuation">[</span>col_name<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        trimmed_data <span class="token operator">&lt;-</span> data.original<span class="token punctuation">[</span><span class="token punctuation">[</span>col_name<span class="token punctuation">]</span><span class="token punctuation">]</span>
        trimmed_data <span class="token operator">&lt;-</span> trimmed_data<span class="token punctuation">[</span><span class="token operator">!</span>is.na<span class="token punctuation">(</span>trimmed_data<span class="token punctuation">)</span><span class="token punctuation">]</span>
        trimmed_data <span class="token operator">&lt;-</span> quantile<span class="token punctuation">(</span>trimmed_data<span class="token punctuation">,</span> c<span class="token punctuation">(</span>trim_limit_bottom<span class="token punctuation">,</span> trim_limit_top<span class="token punctuation">)</span><span class="token punctuation">)</span>
        trimmed_data <span class="token operator">&lt;-</span> data.original<span class="token punctuation">[</span><span class="token punctuation">[</span>col_name<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span>data.original<span class="token punctuation">[</span><span class="token punctuation">[</span>col_name<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> trimmed_data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> data.original<span class="token punctuation">[</span><span class="token punctuation">[</span>col_name<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> trimmed_data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
        
        col_statistics <span class="token operator">&lt;-</span> list<span class="token punctuation">(</span>
            variable <span class="token operator">=</span> col_name<span class="token punctuation">,</span>
            mean <span class="token operator">=</span> mean<span class="token punctuation">(</span>trimmed_data<span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            sd <span class="token operator">=</span> sd<span class="token punctuation">(</span>trimmed_data<span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            P0 <span class="token operator">=</span> quantile<span class="token punctuation">(</span>trimmed_data<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            P25 <span class="token operator">=</span> quantile<span class="token punctuation">(</span>trimmed_data<span class="token punctuation">,</span> <span class="token number">0.25</span><span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            P50 <span class="token operator">=</span> quantile<span class="token punctuation">(</span>trimmed_data<span class="token punctuation">,</span> <span class="token number">0.50</span><span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            P75 <span class="token operator">=</span> quantile<span class="token punctuation">(</span>trimmed_data<span class="token punctuation">,</span> <span class="token number">0.75</span><span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            P100 <span class="token operator">=</span> quantile<span class="token punctuation">(</span>trimmed_data<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
        
        statistics.trimmed <span class="token operator">&lt;-</span> rbind<span class="token punctuation">(</span>statistics.trimmed<span class="token punctuation">,</span> col_statistics<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>The trimmed statistics are shown as followed</p>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code>kable<span class="token punctuation">(</span>statistics.trimmed<span class="token punctuation">,</span> format <span class="token operator">=</span> <span class="token string">'markdown'</span><span class="token punctuation">,</span> digits <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">)</span>
</code></pre><table>
<thead>
<tr>
<th style="text-align:left">variable</th>
<th style="text-align:right">mean</th>
<th style="text-align:right">sd</th>
<th style="text-align:right">P0</th>
<th style="text-align:right">P25</th>
<th style="text-align:right">P50</th>
<th style="text-align:right">P75</th>
<th style="text-align:right">P100</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Revenue Growth</td>
<td style="text-align:right">0.1079</td>
<td style="text-align:right">0.1683</td>
<td style="text-align:right">-0.2530</td>
<td style="text-align:right">0.0000</td>
<td style="text-align:right">0.0749</td>
<td style="text-align:right">0.1709</td>
<td style="text-align:right">0.8014</td>
</tr>
<tr>
<td style="text-align:left">EPS</td>
<td style="text-align:right">0.9908</td>
<td style="text-align:right">2.0191</td>
<td style="text-align:right">-3.7400</td>
<td style="text-align:right">-0.2500</td>
<td style="text-align:right">0.6900</td>
<td style="text-align:right">2.0875</td>
<td style="text-align:right">7.0115</td>
</tr>
<tr>
<td style="text-align:left">Profit Margin</td>
<td style="text-align:right">-0.0927</td>
<td style="text-align:right">0.6382</td>
<td style="text-align:right">-5.1970</td>
<td style="text-align:right">-0.0260</td>
<td style="text-align:right">0.0440</td>
<td style="text-align:right">0.1230</td>
<td style="text-align:right">0.3960</td>
</tr>
<tr>
<td style="text-align:left">Net Profit Margin</td>
<td style="text-align:right">-0.0314</td>
<td style="text-align:right">0.4349</td>
<td style="text-align:right">-3.3991</td>
<td style="text-align:right">-0.0106</td>
<td style="text-align:right">0.0461</td>
<td style="text-align:right">0.1292</td>
<td style="text-align:right">0.4012</td>
</tr>
<tr>
<td style="text-align:left">dividendYield</td>
<td style="text-align:right">0.0139</td>
<td style="text-align:right">0.0221</td>
<td style="text-align:right">0.0000</td>
<td style="text-align:right">0.0000</td>
<td style="text-align:right">0.0000</td>
<td style="text-align:right">0.0217</td>
<td style="text-align:right">0.1099</td>
</tr>
<tr>
<td style="text-align:left">returnOnAssets</td>
<td style="text-align:right">-0.0336</td>
<td style="text-align:right">0.3735</td>
<td style="text-align:right">-1.5201</td>
<td style="text-align:right">-0.1185</td>
<td style="text-align:right">0.0434</td>
<td style="text-align:right">0.1588</td>
<td style="text-align:right">0.8140</td>
</tr>
<tr>
<td style="text-align:left">returnOnEquity</td>
<td style="text-align:right">-0.0072</td>
<td style="text-align:right">0.2962</td>
<td style="text-align:right">-1.2903</td>
<td style="text-align:right">-0.0516</td>
<td style="text-align:right">0.0748</td>
<td style="text-align:right">0.1399</td>
<td style="text-align:right">0.5397</td>
</tr>
<tr>
<td style="text-align:left">debtRatio</td>
<td style="text-align:right">0.2213</td>
<td style="text-align:right">0.1943</td>
<td style="text-align:right">0.0000</td>
<td style="text-align:right">0.0342</td>
<td style="text-align:right">0.1892</td>
<td style="text-align:right">0.3701</td>
<td style="text-align:right">0.7100</td>
</tr>
<tr>
<td style="text-align:left">PE ratio</td>
<td style="text-align:right">12.1548</td>
<td style="text-align:right">13.7354</td>
<td style="text-align:right">0.0000</td>
<td style="text-align:right">0.0000</td>
<td style="text-align:right">9.8927</td>
<td style="text-align:right">18.5583</td>
<td style="text-align:right">65.3438</td>
</tr>
<tr>
<td style="text-align:left">Dividend Yield</td>
<td style="text-align:right">0.0124</td>
<td style="text-align:right">0.0191</td>
<td style="text-align:right">0.0000</td>
<td style="text-align:right">0.0000</td>
<td style="text-align:right">0.0000</td>
<td style="text-align:right">0.0203</td>
<td style="text-align:right">0.0890</td>
</tr>
<tr>
<td style="text-align:left">Book Value per Share Growth</td>
<td style="text-align:right">0.0223</td>
<td style="text-align:right">0.2552</td>
<td style="text-align:right">-0.6658</td>
<td style="text-align:right">-0.0866</td>
<td style="text-align:right">0.0261</td>
<td style="text-align:right">0.1191</td>
<td style="text-align:right">1.0203</td>
</tr>
<tr>
<td style="text-align:left">Debt Growth</td>
<td style="text-align:right">0.0439</td>
<td style="text-align:right">0.2742</td>
<td style="text-align:right">-0.5995</td>
<td style="text-align:right">-0.0636</td>
<td style="text-align:right">0.0000</td>
<td style="text-align:right">0.0912</td>
<td style="text-align:right">1.3284</td>
</tr>
<tr>
<td style="text-align:left">R&amp;D Expense Growth</td>
<td style="text-align:right">0.0374</td>
<td style="text-align:right">0.1064</td>
<td style="text-align:right">-0.1728</td>
<td style="text-align:right">0.0000</td>
<td style="text-align:right">0.0000</td>
<td style="text-align:right">0.0000</td>
<td style="text-align:right">0.5421</td>
</tr>
</tbody>
</table>
<p>Now the mean and std are in the reasonable range. We use modified z-score to scale the data</p>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code>data.scaled <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>row.names <span class="token operator">=</span> row.names<span class="token punctuation">(</span>data.original<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>col_name <span class="token keyword keyword-in">in</span> names<span class="token punctuation">(</span>data.original<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment"># Check if the column is numeric</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>col_name <span class="token percent-operator operator">%in%</span> statistics.trimmed<span class="token operator">$</span>variable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        col_data <span class="token operator">&lt;-</span> data.original<span class="token punctuation">[</span>col_name<span class="token punctuation">]</span>
        mean <span class="token operator">&lt;-</span> statistics.trimmed<span class="token punctuation">[</span>statistics.trimmed<span class="token operator">$</span>variable <span class="token operator">==</span> col_name<span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token operator">$</span>mean
        sd <span class="token operator">&lt;-</span> statistics.trimmed<span class="token punctuation">[</span>statistics.trimmed<span class="token operator">$</span>variable <span class="token operator">==</span> col_name<span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token operator">$</span>sd
        col_scaled <span class="token operator">&lt;-</span> <span class="token punctuation">(</span>col_data <span class="token operator">-</span> mean<span class="token punctuation">)</span> <span class="token operator">/</span> sd
        data.scaled<span class="token punctuation">[</span>col_name<span class="token punctuation">]</span> <span class="token operator">&lt;-</span> col_scaled
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

data.scaled<span class="token punctuation">[</span>is.na<span class="token punctuation">(</span>data.scaled<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">&lt;-</span> <span class="token number">0</span>
<span class="token comment"># some column name is using special characters, replace them</span>
colnames<span class="token punctuation">(</span>data.scaled<span class="token punctuation">)</span> <span class="token operator">&lt;-</span> gsub<span class="token punctuation">(</span><span class="token string">"&amp;"</span><span class="token punctuation">,</span> <span class="token string">"n"</span><span class="token punctuation">,</span> colnames<span class="token punctuation">(</span>data.scaled<span class="token punctuation">)</span><span class="token punctuation">)</span>
colnames<span class="token punctuation">(</span>data.scaled<span class="token punctuation">)</span> <span class="token operator">&lt;-</span> gsub<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span> <span class="token string">"_"</span><span class="token punctuation">,</span> colnames<span class="token punctuation">(</span>data.scaled<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><h3 id="4a2---modeling">4.a.2 - Modeling </h3>
<p>Now the data is properly scaled, we will try different model and use cross-validation to estimate accuracy.</p>
<p>We try difference models with increasing complexity (but not necessarily more accurate).</p>
<h4 id="baseline-no-model-naive">Baseline: No Model (naive) </h4>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code>accuracy.naive <span class="token operator">&lt;-</span> max<span class="token punctuation">(</span>mean<span class="token punctuation">(</span>data.y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">-</span> mean<span class="token punctuation">(</span>data.y<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 0.6935337</span>
</code></pre><p>With no modeling and no information what so ever, the naive estimation has an</p>
<p>accuracy = 69.35%</p>
<h4 id="linear-linear-probability-model">Linear: Linear Probability Model </h4>
<p>fit the model with linear probability</p>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code>fit.linear <span class="token operator">&lt;-</span> lm<span class="token punctuation">(</span>formula<span class="token operator">=</span> data.y <span class="token operator">~</span> .<span class="token punctuation">,</span> data <span class="token operator">=</span> data.scaled<span class="token punctuation">)</span>
</code></pre><p>prune the model with stepAIC</p>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code>library<span class="token punctuation">(</span>MASS<span class="token punctuation">)</span>
stepAIC<span class="token punctuation">(</span>fit.linear<span class="token punctuation">)</span>
</code></pre><p>the best fitted model is</p>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code>fit.linear <span class="token operator">&lt;-</span> lm<span class="token punctuation">(</span>formula <span class="token operator">=</span> data.y <span class="token operator">~</span> EPS <span class="token operator">+</span> Net_Profit_Margin <span class="token operator">+</span> dividendYield <span class="token operator">+</span> 
    returnOnAssets <span class="token operator">+</span> PE_ratio <span class="token operator">+</span> Book_Value_per_Share_Growth<span class="token punctuation">,</span> 
    data <span class="token operator">=</span> data.scaled<span class="token punctuation">)</span>
mean<span class="token punctuation">(</span>ifelse<span class="token punctuation">(</span>predict<span class="token punctuation">(</span>fit.linear<span class="token punctuation">,</span> data.scaled<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">==</span> data.y<span class="token punctuation">)</span>
<span class="token comment"># 0.6948998</span>
</code></pre><p>In sample accuracy is so low that barely makes any difference with the baseline. Implement a simple 5-fold cross validation (we almost know the result will be worse)</p>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code>library<span class="token punctuation">(</span>caret<span class="token punctuation">)</span>

set.seed<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>
cv_results <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>accuracy <span class="token operator">=</span> numeric<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># Perform 5-fold cross-validation</span>
folds <span class="token operator">&lt;-</span> createFolds<span class="token punctuation">(</span>data.y<span class="token punctuation">,</span> k <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">)</span>
<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>fold <span class="token keyword keyword-in">in</span> folds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    train_data <span class="token operator">&lt;-</span> data.scaled<span class="token punctuation">[</span><span class="token operator">-</span>fold<span class="token punctuation">,</span> <span class="token punctuation">]</span>
    test_data <span class="token operator">&lt;-</span> data.scaled<span class="token punctuation">[</span>fold<span class="token punctuation">,</span> <span class="token punctuation">]</span>
    train_y <span class="token operator">&lt;-</span> data.y<span class="token punctuation">[</span><span class="token operator">-</span>fold<span class="token punctuation">]</span>
    test_y <span class="token operator">&lt;-</span> data.y<span class="token punctuation">[</span>fold<span class="token punctuation">]</span>
    
    <span class="token comment"># Fit the model on the training data</span>
    model <span class="token operator">&lt;-</span> lm<span class="token punctuation">(</span>formula <span class="token operator">=</span> train_y <span class="token operator">~</span> EPS <span class="token operator">+</span> Net_Profit_Margin <span class="token operator">+</span> dividendYield <span class="token operator">+</span> 
                returnOnAssets <span class="token operator">+</span> PE_ratio <span class="token operator">+</span> Book_Value_per_Share_Growth<span class="token punctuation">,</span> 
                data <span class="token operator">=</span> train_data<span class="token punctuation">)</span>
    
    <span class="token comment"># Predict probabilities on the test data</span>
    predicted_probs <span class="token operator">&lt;-</span> predict<span class="token punctuation">(</span>model<span class="token punctuation">,</span> newdata <span class="token operator">=</span> test_data<span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token string">"response"</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Convert probabilities to binary predictions (0 or 1)</span>
    predicted_labels <span class="token operator">&lt;-</span> ifelse<span class="token punctuation">(</span>predicted_probs <span class="token operator">&gt;</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Calculate accuracy and store in cv_results</span>
    accuracy <span class="token operator">&lt;-</span> mean<span class="token punctuation">(</span>predicted_labels <span class="token operator">==</span> test_y<span class="token punctuation">)</span>
    cv_results <span class="token operator">&lt;-</span> rbind<span class="token punctuation">(</span>cv_results<span class="token punctuation">,</span> data.frame<span class="token punctuation">(</span>accuracy <span class="token operator">=</span> accuracy<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment"># Calculate the mean accuracy over the 5 folds</span>
accuracy.linear <span class="token operator">&lt;-</span> mean<span class="token punctuation">(</span>cv_results<span class="token operator">$</span>accuracy<span class="token punctuation">)</span>
accuracy.linear
<span class="token comment"># 0.6946701</span>
</code></pre><p>accuracy = 69.47%, barely any information gain (only 0.012%), comparing to baseline.</p>
<ul>
<li>the features are highly non-linear in nature.</li>
<li>AIC selection drops information, even this helps fight over-fitting.</li>
<li>the label is not balanced, since the model basically learns nothing, the predicted prob is very closed to the population mean.</li>
<li>thus most of the predicted label is <code>1</code>.</li>
<li>resulting very close prediction, to the naive way.</li>
</ul>
<h4 id="linear-logistic-probability-model">Linear: Logistic Probability Model </h4>
<p>use logistic regression to compensate some non-linearity issue.</p>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code>fit.logistic <span class="token operator">&lt;-</span> glm<span class="token punctuation">(</span>formula <span class="token operator">=</span> data.y <span class="token operator">~</span> .<span class="token punctuation">,</span> data <span class="token operator">=</span> data.scaled<span class="token punctuation">,</span> family <span class="token operator">=</span> <span class="token string">"binomial"</span><span class="token punctuation">)</span>
</code></pre><p>prune the model with stepAIC</p>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code>stepAIC<span class="token punctuation">(</span>fit.logistic<span class="token punctuation">)</span>
</code></pre><p>the best fitted model is</p>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code>fit.logistic <span class="token operator">&lt;-</span> glm<span class="token punctuation">(</span>formula <span class="token operator">=</span> data.y <span class="token operator">~</span> EPS <span class="token operator">+</span> Net_Profit_Margin <span class="token operator">+</span> dividendYield <span class="token operator">+</span> 
    debtRatio <span class="token operator">+</span> PE_ratio <span class="token operator">+</span> Book_Value_per_Share_Growth<span class="token punctuation">,</span> family <span class="token operator">=</span> <span class="token string">"binomial"</span><span class="token punctuation">,</span> 
    data <span class="token operator">=</span> data.scaled<span class="token punctuation">)</span>
mean<span class="token punctuation">(</span>ifelse<span class="token punctuation">(</span>predict<span class="token punctuation">(</span>fit.logistic<span class="token punctuation">,</span> data.scaled<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">==</span> data.y<span class="token punctuation">)</span>
<span class="token comment"># 0.6983151</span>
</code></pre><p>The in-sample result is slightly better. And we use the cross-validation code above we have:</p>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code>set.seed<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>
cv_results <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>accuracy <span class="token operator">=</span> numeric<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># Perform 5-fold cross-validation</span>
folds <span class="token operator">&lt;-</span> createFolds<span class="token punctuation">(</span>data.y<span class="token punctuation">,</span> k <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">)</span>
<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>fold <span class="token keyword keyword-in">in</span> folds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    train_data <span class="token operator">&lt;-</span> data.scaled<span class="token punctuation">[</span><span class="token operator">-</span>fold<span class="token punctuation">,</span> <span class="token punctuation">]</span>
    test_data <span class="token operator">&lt;-</span> data.scaled<span class="token punctuation">[</span>fold<span class="token punctuation">,</span> <span class="token punctuation">]</span>
    train_y <span class="token operator">&lt;-</span> data.y<span class="token punctuation">[</span><span class="token operator">-</span>fold<span class="token punctuation">]</span>
    test_y <span class="token operator">&lt;-</span> data.y<span class="token punctuation">[</span>fold<span class="token punctuation">]</span>
    model <span class="token operator">&lt;-</span> glm<span class="token punctuation">(</span>formula <span class="token operator">=</span> train_y <span class="token operator">~</span> EPS <span class="token operator">+</span> Net_Profit_Margin <span class="token operator">+</span> dividendYield <span class="token operator">+</span> 
    debtRatio <span class="token operator">+</span> PE_ratio <span class="token operator">+</span> Book_Value_per_Share_Growth<span class="token punctuation">,</span> family <span class="token operator">=</span> <span class="token string">"binomial"</span><span class="token punctuation">,</span> 
    data <span class="token operator">=</span> train_data<span class="token punctuation">)</span>

    predicted_probs <span class="token operator">&lt;-</span> predict<span class="token punctuation">(</span>model<span class="token punctuation">,</span> newdata <span class="token operator">=</span> test_data<span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token string">"response"</span><span class="token punctuation">)</span>
    predicted_labels <span class="token operator">&lt;-</span> ifelse<span class="token punctuation">(</span>predicted_probs <span class="token operator">&gt;</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

    accuracy <span class="token operator">&lt;-</span> mean<span class="token punctuation">(</span>predicted_labels <span class="token operator">==</span> test_y<span class="token punctuation">)</span>
    cv_results <span class="token operator">&lt;-</span> rbind<span class="token punctuation">(</span>cv_results<span class="token punctuation">,</span> data.frame<span class="token punctuation">(</span>accuracy <span class="token operator">=</span> accuracy<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment"># Calculate the mean accuracy over the 5 folds</span>
accuracy.logistic <span class="token operator">&lt;-</span> mean<span class="token punctuation">(</span>cv_results<span class="token operator">$</span>accuracy<span class="token punctuation">)</span>
accuracy.logistic
<span class="token comment"># 0.6964911</span>
</code></pre><p>accuracy = 69.65%, better than the linear, but still barely any information gain (only 0.30%), comparing to baseline.</p>
<ul>
<li>extreme outliers affecting the fit! (since loss takes outlier with extreme weights)</li>
<li>again, the features are highly non-linear in nature.</li>
<li>and again, AIC selection drops information, even this helps fight over-fitting.</li>
<li>and again, the label is not balanced, since the model basically learns nothing, the predicted prob is very closed to the population mean.</li>
<li>so the result is similar to the linear probability model thus most of the predicted label is <code>1</code>.</li>
<li>resulting very close prediction, to the naive way.</li>
<li>note that in the fitting process, there are warning messages that show 'fitted probabilities numerically 0 or 1 occurred'</li>
<li>this is usually caused by the outlier, we do the following modification.</li>
</ul>
<h4 id="linear-logistic-probability-model-modified">Linear: Logistic Probability Model, Modified </h4>
<p>Since the linear model takes heavy penalty on outliers, we just trim them from the training set</p>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code><span class="token comment"># Set the percentage for outliers (1% on each end)</span>
outlier_percentage <span class="token operator">&lt;-</span> <span class="token number">0.01</span>

<span class="token comment"># Initialize a vector to store indices of outliers to remove</span>
outlier_indices <span class="token operator">&lt;-</span> integer<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment"># Loop through each numeric column in the data frame</span>
<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>col_name <span class="token keyword keyword-in">in</span> names<span class="token punctuation">(</span>data.scaled<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>is.numeric<span class="token punctuation">(</span>data.scaled<span class="token punctuation">[</span><span class="token punctuation">[</span>col_name<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> col_name <span class="token operator">!=</span> <span class="token string">"y"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    column_data <span class="token operator">&lt;-</span> data.scaled<span class="token punctuation">[</span><span class="token punctuation">[</span>col_name<span class="token punctuation">]</span><span class="token punctuation">]</span>
    
    <span class="token comment"># Calculate the lower and upper percentiles for outliers</span>
    lower_percentile <span class="token operator">&lt;-</span> quantile<span class="token punctuation">(</span>column_data<span class="token punctuation">,</span> outlier_percentage<span class="token punctuation">)</span>
    upper_percentile <span class="token operator">&lt;-</span> quantile<span class="token punctuation">(</span>column_data<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">-</span> outlier_percentage<span class="token punctuation">)</span>
    
    <span class="token comment"># Find indices of outliers and append to the outlier_indices vector</span>
    lower_outliers <span class="token operator">&lt;-</span> which<span class="token punctuation">(</span>column_data <span class="token operator">&lt;</span> lower_percentile<span class="token punctuation">)</span>
    upper_outliers <span class="token operator">&lt;-</span> which<span class="token punctuation">(</span>column_data <span class="token operator">&gt;</span> upper_percentile<span class="token punctuation">)</span>
    outlier_indices <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span>outlier_indices<span class="token punctuation">,</span> lower_outliers<span class="token punctuation">,</span> upper_outliers<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment"># Merge the outlier indices and remove duplicates</span>
outlier_indices <span class="token operator">&lt;-</span> unique<span class="token punctuation">(</span>outlier_indices<span class="token punctuation">)</span>

<span class="token comment"># Remove outliers from the data</span>
data.scaled.trimmed <span class="token operator">&lt;-</span> data.scaled<span class="token punctuation">[</span><span class="token operator">-</span>outlier_indices<span class="token punctuation">,</span> <span class="token punctuation">]</span>
data.y.trimmed <span class="token operator">&lt;-</span> data.y<span class="token punctuation">[</span><span class="token operator">-</span>outlier_indices<span class="token punctuation">]</span>
print<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> length<span class="token punctuation">(</span>data.y.trimmed<span class="token punctuation">)</span> <span class="token operator">/</span> length<span class="token punctuation">(</span>data.y<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 0.1530055</span>
</code></pre><p>This trimming cut out 15.30% observations. Then do repeat the steps above.</p>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code>fit.logistic.trimmed <span class="token operator">&lt;-</span> glm<span class="token punctuation">(</span>formula<span class="token operator">=</span> data.y.trimmed <span class="token operator">~</span> .<span class="token punctuation">,</span> data <span class="token operator">=</span> data.scaled.trimmed<span class="token punctuation">,</span> family <span class="token operator">=</span> <span class="token string">"binomial"</span><span class="token punctuation">)</span>
stepAIC<span class="token punctuation">(</span>fit.logistic.trimmed<span class="token punctuation">)</span>
</code></pre><p>This time, we change the function family to gaussian, more factors are left, the best model is</p>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code>fit.logistic.trimmed <span class="token operator">&lt;-</span> glm<span class="token punctuation">(</span>formula <span class="token operator">=</span> data.y.trimmed <span class="token operator">~</span> Revenue_Growth <span class="token operator">+</span> EPS <span class="token operator">+</span> Profit_Margin <span class="token operator">+</span> 
    dividendYield <span class="token operator">+</span> returnOnAssets <span class="token operator">+</span> returnOnEquity <span class="token operator">+</span> debtRatio <span class="token operator">+</span> 
    PE_ratio <span class="token operator">+</span> Dividend_Yield<span class="token punctuation">,</span> family <span class="token operator">=</span> <span class="token string">"binomial"</span><span class="token punctuation">,</span> data <span class="token operator">=</span> data.scaled.trimmed<span class="token punctuation">)</span>
mean<span class="token punctuation">(</span>ifelse<span class="token punctuation">(</span>predict<span class="token punctuation">(</span>fit.logistic.trimmed<span class="token punctuation">,</span> data.scaled<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">==</span> data.y<span class="token punctuation">)</span>
<span class="token comment"># 0.6983151</span>
</code></pre><p>This time the warning message is gone, suggesting we successfully remove the outliers, the "in-sample" accuracy (technically this is not all in-sample, since we include the trimmed data, otherwise we cannot make comparison) rate is the better, and we keep more features.</p>
<p>We modify the cross validation code, so that our trimmed data not entering the training set, but it is allowed in the test set (so the accuracy is comparable).</p>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code>set.seed<span class="token punctuation">(</span><span class="token number">142</span><span class="token punctuation">)</span>
cv_results <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>accuracy <span class="token operator">=</span> numeric<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># Perform 5-fold cross-validation</span>
folds <span class="token operator">&lt;-</span> createFolds<span class="token punctuation">(</span>data.y<span class="token punctuation">,</span> k <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">)</span>
<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>fold <span class="token keyword keyword-in">in</span> folds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    
    train_data <span class="token operator">&lt;-</span> data.scaled<span class="token punctuation">[</span><span class="token operator">-</span>fold<span class="token punctuation">,</span> <span class="token punctuation">]</span>
    test_data <span class="token operator">&lt;-</span> data.scaled<span class="token punctuation">[</span>fold<span class="token punctuation">,</span> <span class="token punctuation">]</span>
    train_y <span class="token operator">&lt;-</span> data.y<span class="token punctuation">[</span><span class="token operator">-</span>fold<span class="token punctuation">]</span>
    test_y <span class="token operator">&lt;-</span> data.y<span class="token punctuation">[</span>fold<span class="token punctuation">]</span>

    trimmed_indices <span class="token operator">&lt;-</span> intersect<span class="token punctuation">(</span>fold<span class="token punctuation">,</span> outlier_indices<span class="token punctuation">)</span>
    train_data <span class="token operator">&lt;-</span> train_data<span class="token punctuation">[</span><span class="token operator">-</span>trimmed_indices<span class="token punctuation">,</span> <span class="token punctuation">]</span>
    train_y <span class="token operator">&lt;-</span> train_y<span class="token punctuation">[</span><span class="token operator">-</span>trimmed_indices<span class="token punctuation">]</span>

    model <span class="token operator">&lt;-</span> glm<span class="token punctuation">(</span>formula <span class="token operator">=</span> train_y <span class="token operator">~</span> Revenue_Growth <span class="token operator">+</span> EPS <span class="token operator">+</span> Profit_Margin <span class="token operator">+</span> 
    dividendYield <span class="token operator">+</span> returnOnAssets <span class="token operator">+</span> returnOnEquity <span class="token operator">+</span> debtRatio <span class="token operator">+</span> 
    PE_ratio <span class="token operator">+</span> Dividend_Yield<span class="token punctuation">,</span> family <span class="token operator">=</span> <span class="token string">"binomial"</span><span class="token punctuation">,</span> data <span class="token operator">=</span> train_data<span class="token punctuation">)</span>

    predicted_probs <span class="token operator">&lt;-</span> predict<span class="token punctuation">(</span>model<span class="token punctuation">,</span> newdata <span class="token operator">=</span> test_data<span class="token punctuation">)</span>
    predicted_labels <span class="token operator">&lt;-</span> ifelse<span class="token punctuation">(</span>predicted_probs <span class="token operator">&gt;</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

    accuracy <span class="token operator">&lt;-</span> mean<span class="token punctuation">(</span>predicted_labels <span class="token operator">==</span> test_y<span class="token punctuation">)</span>
    cv_results <span class="token operator">&lt;-</span> rbind<span class="token punctuation">(</span>cv_results<span class="token punctuation">,</span> data.frame<span class="token punctuation">(</span>accuracy <span class="token operator">=</span> accuracy<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment"># Calculate the mean accuracy over the 5 folds</span>
accuracy.logistic.trimmed <span class="token operator">&lt;-</span> mean<span class="token punctuation">(</span>cv_results<span class="token operator">$</span>accuracy<span class="token punctuation">)</span>
accuracy.logistic.trimmed
<span class="token comment"># 0.699674</span>
</code></pre><p>The cross validation result barely makes any difference. Note that the random fluctuation of the cross validation gives the result some variation, and this variation is greater than the difference between accuracy differences across each model.</p>
<h4 id="linear-qda">Linear: QDA </h4>
<p>Since the assumption for LDA is not met in this case, and population is large enough, we skip the LDA and use QDA</p>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code>fit.qda <span class="token operator">&lt;-</span> qda<span class="token punctuation">(</span>as.factor<span class="token punctuation">(</span>data.y<span class="token punctuation">)</span> <span class="token operator">~</span> .<span class="token punctuation">,</span> data <span class="token operator">=</span> data.scaled<span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token string">'t'</span><span class="token punctuation">)</span>
</code></pre><pre data-role="codeBlock" data-info="R" class="language-r R"><code>set.seed<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>
cv_results <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>accuracy <span class="token operator">=</span> numeric<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># Perform 5-fold cross-validation</span>
folds <span class="token operator">&lt;-</span> createFolds<span class="token punctuation">(</span>data.y<span class="token punctuation">,</span> k <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">)</span>
<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>fold <span class="token keyword keyword-in">in</span> folds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    train_data <span class="token operator">&lt;-</span> data.scaled<span class="token punctuation">[</span><span class="token operator">-</span>fold<span class="token punctuation">,</span> <span class="token punctuation">]</span>
    test_data <span class="token operator">&lt;-</span> data.scaled<span class="token punctuation">[</span>fold<span class="token punctuation">,</span> <span class="token punctuation">]</span>
    train_y <span class="token operator">&lt;-</span> data.y<span class="token punctuation">[</span><span class="token operator">-</span>fold<span class="token punctuation">]</span>
    test_y <span class="token operator">&lt;-</span> data.y<span class="token punctuation">[</span>fold<span class="token punctuation">]</span>

    model <span class="token operator">&lt;-</span> qda<span class="token punctuation">(</span>as.factor<span class="token punctuation">(</span>train_y<span class="token punctuation">)</span> <span class="token operator">~</span> .<span class="token punctuation">,</span> data <span class="token operator">=</span> train_data<span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token string">'t'</span><span class="token punctuation">,</span> means <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> nu <span class="token operator">=</span> length<span class="token punctuation">(</span>names<span class="token punctuation">(</span>data.scaled<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span><span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span>

    predicted_labels <span class="token operator">&lt;-</span> predict<span class="token punctuation">(</span>model<span class="token punctuation">,</span> newdata <span class="token operator">=</span> test_data<span class="token punctuation">)</span><span class="token operator">$</span>class
    accuracy <span class="token operator">&lt;-</span> mean<span class="token punctuation">(</span>predicted_labels <span class="token operator">==</span> as.factor<span class="token punctuation">(</span>test_y<span class="token punctuation">)</span><span class="token punctuation">)</span>
    cv_results <span class="token operator">&lt;-</span> rbind<span class="token punctuation">(</span>cv_results<span class="token punctuation">,</span> data.frame<span class="token punctuation">(</span>accuracy <span class="token operator">=</span> accuracy<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment"># Calculate the mean accuracy over the 5 folds</span>
accuracy.qda <span class="token operator">&lt;-</span> mean<span class="token punctuation">(</span>cv_results<span class="token operator">$</span>accuracy<span class="token punctuation">)</span>
accuracy.qda
<span class="token comment"># 0.6942151</span>
</code></pre><p>accuracy = 69.42%, better than the linear, worse than logistic (only 0.23% info gain)</p>
<ul>
<li>the distribution of the features is not normal, as shown at first part.</li>
<li>thus we have to use t-distribution, with a lot of degrees of freedom.</li>
<li>suffer the same faults as the linear model.</li>
<li>thus the model is not well fitted.</li>
<li>we also tested the LDA model, results are similar.</li>
</ul>
<h4 id="random-forest">Random Forest </h4>
<p>Random forest should do better since</p>
<ul>
<li>can utilize all the info / features</li>
<li>highly no-linear</li>
<li>is a average of batch of prediction, should do better than a single model.</li>
<li>so far the most sophisticated model</li>
</ul>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code>library<span class="token punctuation">(</span>randomForest<span class="token punctuation">)</span>

fit.rf <span class="token operator">&lt;-</span> randomForest<span class="token punctuation">(</span>as.factor<span class="token punctuation">(</span>data.y<span class="token punctuation">)</span> <span class="token operator">~</span> .<span class="token punctuation">,</span> data <span class="token operator">=</span> data.scaled<span class="token punctuation">,</span> mtry<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span> ntree <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">)</span>
mean<span class="token punctuation">(</span>predict<span class="token punctuation">(</span>fit.rf<span class="token punctuation">,</span> data.scaled<span class="token punctuation">)</span> <span class="token operator">==</span> as.factor<span class="token punctuation">(</span>data.y<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 0.9977231</span>
</code></pre><p>As we can see in-sample result is good (even it is too good to be true), suggesting a good (over) fit. We can live with some over-fitting. Cross validation results are:</p>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code>set.seed<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>
cv_results <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>accuracy <span class="token operator">=</span> numeric<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># Perform 5-fold cross-validation</span>
folds <span class="token operator">&lt;-</span> createFolds<span class="token punctuation">(</span>data.y<span class="token punctuation">,</span> k <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">)</span>
<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>fold <span class="token keyword keyword-in">in</span> folds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    train_data <span class="token operator">&lt;-</span> data.scaled<span class="token punctuation">[</span><span class="token operator">-</span>fold<span class="token punctuation">,</span> <span class="token punctuation">]</span>
    test_data <span class="token operator">&lt;-</span> data.scaled<span class="token punctuation">[</span>fold<span class="token punctuation">,</span> <span class="token punctuation">]</span>
    train_y <span class="token operator">&lt;-</span> data.y<span class="token punctuation">[</span><span class="token operator">-</span>fold<span class="token punctuation">]</span>
    test_y <span class="token operator">&lt;-</span> data.y<span class="token punctuation">[</span>fold<span class="token punctuation">]</span>

    model <span class="token operator">&lt;-</span>  randomForest<span class="token punctuation">(</span>as.factor<span class="token punctuation">(</span>train_y<span class="token punctuation">)</span> <span class="token operator">~</span> .<span class="token punctuation">,</span> data <span class="token operator">=</span> train_data<span class="token punctuation">,</span> mtry<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span> ntree <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">)</span>

    predicted_labels <span class="token operator">&lt;-</span> predict<span class="token punctuation">(</span>model<span class="token punctuation">,</span> newdata <span class="token operator">=</span> test_data<span class="token punctuation">)</span>
    accuracy <span class="token operator">&lt;-</span> mean<span class="token punctuation">(</span>predicted_labels <span class="token operator">==</span> as.factor<span class="token punctuation">(</span>test_y<span class="token punctuation">)</span><span class="token punctuation">)</span>
    cv_results <span class="token operator">&lt;-</span> rbind<span class="token punctuation">(</span>cv_results<span class="token punctuation">,</span> data.frame<span class="token punctuation">(</span>accuracy <span class="token operator">=</span> accuracy<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment"># Calculate the mean accuracy over the 5 folds</span>
accuracy.rf <span class="token operator">&lt;-</span> mean<span class="token punctuation">(</span>cv_results<span class="token operator">$</span>accuracy<span class="token punctuation">)</span>
accuracy.rf
<span class="token comment"># 0.71517</span>
</code></pre><p>Accuracy = 71.52%, best result so far, but still not good enough (info gain = 2.16%) for any viable prediction / strategy.</p>
<ul>
<li>we have try different <code>mtry</code> for the random forest, and 6 is the best in both training and validation result.</li>
<li><code>ntree</code> is large enough that increasing it does not give any noticeable improvement.</li>
</ul>
<h4 id="svm">SVM </h4>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code>library<span class="token punctuation">(</span>e1071<span class="token punctuation">)</span>

fit.svm <span class="token operator">&lt;-</span> svm<span class="token punctuation">(</span>as.factor<span class="token punctuation">(</span>data.y<span class="token punctuation">)</span> <span class="token operator">~</span> .<span class="token punctuation">,</span> data <span class="token operator">=</span> data.scaled<span class="token punctuation">,</span> kernel <span class="token operator">=</span> <span class="token string">"polynomial"</span><span class="token punctuation">,</span> degree<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> tolerance <span class="token operator">=</span> <span class="token number">0.001</span><span class="token punctuation">,</span> k <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span> cost <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">)</span>
mean<span class="token punctuation">(</span>predict<span class="token punctuation">(</span>fit.svm<span class="token punctuation">,</span> data.scaled<span class="token punctuation">)</span> <span class="token operator">==</span> as.factor<span class="token punctuation">(</span>data.y<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 0.701275</span>
</code></pre><p>As we can see in-sample result is not too high, but svm usually have strong generalization ability. Also, essentially, random forests use the strategy of bagging, and mixed predictions are naturally more accurate than single prediction models.</p>
<p>Cross validation results are:</p>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code>set.seed<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>
cv_results <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>accuracy <span class="token operator">=</span> numeric<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># Perform 5-fold cross-validation</span>
folds <span class="token operator">&lt;-</span> createFolds<span class="token punctuation">(</span>data.y<span class="token punctuation">,</span> k <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">)</span>
<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>fold <span class="token keyword keyword-in">in</span> folds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    train_data <span class="token operator">&lt;-</span> data.scaled<span class="token punctuation">[</span><span class="token operator">-</span>fold<span class="token punctuation">,</span> <span class="token punctuation">]</span>
    test_data <span class="token operator">&lt;-</span> data.scaled<span class="token punctuation">[</span>fold<span class="token punctuation">,</span> <span class="token punctuation">]</span>
    train_y <span class="token operator">&lt;-</span> data.y<span class="token punctuation">[</span><span class="token operator">-</span>fold<span class="token punctuation">]</span>
    test_y <span class="token operator">&lt;-</span> data.y<span class="token punctuation">[</span>fold<span class="token punctuation">]</span>

    model <span class="token operator">&lt;-</span> svm<span class="token punctuation">(</span>as.factor<span class="token punctuation">(</span>train_y<span class="token punctuation">)</span> <span class="token operator">~</span> .<span class="token punctuation">,</span> data <span class="token operator">=</span> train_data<span class="token punctuation">,</span> kernel <span class="token operator">=</span> <span class="token string">"polynomial"</span><span class="token punctuation">,</span> tolerance <span class="token operator">=</span> <span class="token number">0.001</span><span class="token punctuation">,</span> cost <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>

    predicted_labels <span class="token operator">&lt;-</span> predict<span class="token punctuation">(</span>model<span class="token punctuation">,</span> newdata <span class="token operator">=</span> test_data<span class="token punctuation">)</span>
    accuracy <span class="token operator">&lt;-</span> mean<span class="token punctuation">(</span>predicted_labels <span class="token operator">==</span> as.factor<span class="token punctuation">(</span>test_y<span class="token punctuation">)</span><span class="token punctuation">)</span>
    cv_results <span class="token operator">&lt;-</span> rbind<span class="token punctuation">(</span>cv_results<span class="token punctuation">,</span> data.frame<span class="token punctuation">(</span>accuracy <span class="token operator">=</span> accuracy<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment"># Calculate the mean accuracy over the 5 folds</span>
accuracy.svm <span class="token operator">&lt;-</span> mean<span class="token punctuation">(</span>cv_results<span class="token operator">$</span>accuracy<span class="token punctuation">)</span>
accuracy.svm
<span class="token comment"># 0.6919379</span>
</code></pre><p>still not as good as random forest</p>
<ul>
<li>as we point out above, random forest uses bagging, which is very suitable for this kind of tasks</li>
<li>variable contains too much noise and is mingled together, single SVM is not advised.</li>
</ul>
<h4 id="knn">KNN </h4>
<p>The task is a highly non-linear, complex task, simple non-parameter modelKNN should not be performing too very in this case.</p>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code>library<span class="token punctuation">(</span>kknn<span class="token punctuation">)</span>
fit.knn <span class="token operator">&lt;-</span> train.kknn<span class="token punctuation">(</span>as.factor<span class="token punctuation">(</span>train_y<span class="token punctuation">)</span> <span class="token operator">~</span> .<span class="token punctuation">,</span> data <span class="token operator">=</span> train_data<span class="token punctuation">,</span> scale <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span> kmax <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">,</span> kcv <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span> kernel <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"rectangular"</span><span class="token punctuation">,</span> <span class="token string">"triangular"</span><span class="token punctuation">,</span> <span class="token string">"epanechnikov"</span><span class="token punctuation">,</span> <span class="token string">"gaussian"</span><span class="token punctuation">,</span> <span class="token string">"rank"</span><span class="token punctuation">,</span> <span class="token string">"optimal"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
mean<span class="token punctuation">(</span>predict<span class="token punctuation">(</span>fit.knn<span class="token punctuation">,</span> data.scaled<span class="token punctuation">)</span> <span class="token operator">==</span> as.factor<span class="token punctuation">(</span>data.y<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 0.7736794</span>
</code></pre><p>a in-sample accuracy of 75.80%, good fit.</p>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code>set.seed<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>
cv_results <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>accuracy <span class="token operator">=</span> numeric<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># Perform 5-fold cross-validation</span>
folds <span class="token operator">&lt;-</span> createFolds<span class="token punctuation">(</span>data.y<span class="token punctuation">,</span> k <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">)</span>
<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>fold <span class="token keyword keyword-in">in</span> folds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    train_data <span class="token operator">&lt;-</span> data.scaled<span class="token punctuation">[</span><span class="token operator">-</span>fold<span class="token punctuation">,</span> <span class="token punctuation">]</span>
    test_data <span class="token operator">&lt;-</span> data.scaled<span class="token punctuation">[</span>fold<span class="token punctuation">,</span> <span class="token punctuation">]</span>
    train_y <span class="token operator">&lt;-</span> data.y<span class="token punctuation">[</span><span class="token operator">-</span>fold<span class="token punctuation">]</span>
    test_y <span class="token operator">&lt;-</span> data.y<span class="token punctuation">[</span>fold<span class="token punctuation">]</span>

    model <span class="token operator">&lt;-</span> train.kknn<span class="token punctuation">(</span>as.factor<span class="token punctuation">(</span>train_y<span class="token punctuation">)</span> <span class="token operator">~</span> .<span class="token punctuation">,</span> data <span class="token operator">=</span> train_data<span class="token punctuation">,</span> scale <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span> kmax <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">,</span> kcv <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span> 
                        kernel <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"rectangular"</span><span class="token punctuation">,</span> <span class="token string">"triangular"</span><span class="token punctuation">,</span> <span class="token string">"epanechnikov"</span><span class="token punctuation">,</span> 
                        <span class="token string">"gaussian"</span><span class="token punctuation">,</span> <span class="token string">"rank"</span><span class="token punctuation">,</span> <span class="token string">"optimal"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    predicted_labels <span class="token operator">&lt;-</span> predict<span class="token punctuation">(</span>model<span class="token punctuation">,</span> newdata <span class="token operator">=</span> test_data<span class="token punctuation">)</span>
    accuracy <span class="token operator">&lt;-</span> mean<span class="token punctuation">(</span>predicted_labels <span class="token operator">==</span> as.factor<span class="token punctuation">(</span>test_y<span class="token punctuation">)</span><span class="token punctuation">)</span>
    cv_results <span class="token operator">&lt;-</span> rbind<span class="token punctuation">(</span>cv_results<span class="token punctuation">,</span> data.frame<span class="token punctuation">(</span>accuracy <span class="token operator">=</span> accuracy<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment"># Calculate the mean accuracy over the 5 folds</span>
accuracy.knn <span class="token operator">&lt;-</span> mean<span class="token punctuation">(</span>cv_results<span class="token operator">$</span>accuracy<span class="token punctuation">)</span>
accuracy.knn
<span class="token comment"># 0.6958049</span>
</code></pre><h4 id="bagged-svm">Bagged: SVM </h4>
<p>A simple bagging svm is implemented below</p>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code>set.seed<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>
num_models <span class="token operator">&lt;-</span> <span class="token number">1000</span>
feature_size <span class="token operator">&lt;-</span> <span class="token number">5</span>
sample_size <span class="token operator">&lt;-</span> nrow<span class="token punctuation">(</span>data.scaled<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">10</span>
cv_results <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>accuracy <span class="token operator">=</span> numeric<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># Perform 5-fold cross-validation</span>
folds <span class="token operator">&lt;-</span> createFolds<span class="token punctuation">(</span>data.y<span class="token punctuation">,</span> k <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">)</span>
<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>fold <span class="token keyword keyword-in">in</span> folds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    train_data <span class="token operator">&lt;-</span> data.scaled<span class="token punctuation">[</span><span class="token operator">-</span>fold<span class="token punctuation">,</span> <span class="token punctuation">]</span>
    test_data <span class="token operator">&lt;-</span> data.scaled<span class="token punctuation">[</span>fold<span class="token punctuation">,</span> <span class="token punctuation">]</span>
    train_y <span class="token operator">&lt;-</span> data.y<span class="token punctuation">[</span><span class="token operator">-</span>fold<span class="token punctuation">]</span>
    test_y <span class="token operator">&lt;-</span> data.y<span class="token punctuation">[</span>fold<span class="token punctuation">]</span>

    trimmed_indices <span class="token operator">&lt;-</span> intersect<span class="token punctuation">(</span>fold<span class="token punctuation">,</span> outlier_indices<span class="token punctuation">)</span>
    train_data <span class="token operator">&lt;-</span> train_data<span class="token punctuation">[</span><span class="token operator">-</span>trimmed_indices<span class="token punctuation">,</span> <span class="token punctuation">]</span>
    train_y <span class="token operator">&lt;-</span> train_y<span class="token punctuation">[</span><span class="token operator">-</span>trimmed_indices<span class="token punctuation">]</span>

  <span class="token comment"># Number of SVM models to create (adjust as needed)</span>
  
  <span class="token comment"># Initialize a list to store individual SVM models</span>
  svm_models <span class="token operator">&lt;-</span> list<span class="token punctuation">(</span><span class="token punctuation">)</span>
  svm_weights <span class="token operator">&lt;-</span> numeric<span class="token punctuation">(</span>num_models<span class="token punctuation">)</span>

  <span class="token comment"># Train multiple SVM models</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>i <span class="token keyword keyword-in">in</span> <span class="token number">1</span><span class="token operator">:</span>num_models<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment"># Create a random subset of the training data with replacement</span>
        n <span class="token operator">&lt;-</span> nrow<span class="token punctuation">(</span>train_data<span class="token punctuation">)</span>
        sample_indices <span class="token operator">&lt;-</span> sample<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span>n<span class="token punctuation">,</span> size <span class="token operator">=</span> sample_size<span class="token punctuation">,</span> replace <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span>
        sampled_train_data <span class="token operator">&lt;-</span> train_data<span class="token punctuation">[</span>sample_indices<span class="token punctuation">,</span> <span class="token punctuation">]</span>
        sampled_train_y <span class="token operator">&lt;-</span> train_y<span class="token punctuation">[</span>sample_indices<span class="token punctuation">]</span>
        
        n <span class="token operator">&lt;-</span> ncol<span class="token punctuation">(</span>sampled_train_data<span class="token punctuation">)</span>
        variables.index <span class="token operator">&lt;-</span> sample<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span>n<span class="token punctuation">,</span> size <span class="token operator">=</span> feature_size<span class="token punctuation">)</span>
        variables.selected <span class="token operator">&lt;-</span> names<span class="token punctuation">(</span>sampled_train_data<span class="token punctuation">)</span><span class="token punctuation">[</span>variables.index<span class="token punctuation">]</span>
        sampled_train_data <span class="token operator">&lt;-</span> sampled_train_data<span class="token punctuation">[</span><span class="token punctuation">,</span> variables.selected<span class="token punctuation">]</span>

        <span class="token comment"># Fit an SVM model on the sampled data</span>
        svm_model <span class="token operator">&lt;-</span> svm<span class="token punctuation">(</span>as.factor<span class="token punctuation">(</span>sampled_train_y<span class="token punctuation">)</span> <span class="token operator">~</span> .<span class="token punctuation">,</span> data <span class="token operator">=</span> sampled_train_data<span class="token punctuation">,</span> kernel <span class="token operator">=</span> <span class="token string">"polynomial"</span><span class="token punctuation">,</span> tolerance <span class="token operator">=</span> <span class="token number">0.001</span><span class="token punctuation">,</span> cross <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span> cost <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Calculate the accuracy and compute the weight (square of accuracy)</span>
        accuracy <span class="token operator">&lt;-</span> svm_model<span class="token operator">$</span>tot.accuracy
        weight <span class="token operator">&lt;-</span> max<span class="token punctuation">(</span>accuracy<span class="token operator">^</span><span class="token number">2</span> <span class="token operator">-</span> <span class="token punctuation">(</span>mean<span class="token punctuation">(</span>data.y<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token operator">^</span><span class="token number">2</span> <span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

        <span class="token comment"># Store the trained SVM model</span>
        svm_models<span class="token punctuation">[</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&lt;-</span> svm_model
        svm_weights<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;-</span> weight
    <span class="token punctuation">}</span>

    <span class="token comment"># Predict class labels on the test data using each SVM model</span>
    predicted.labels <span class="token operator">&lt;-</span> sapply<span class="token punctuation">(</span>svm_models<span class="token punctuation">,</span> <span class="token keyword keyword-function">function</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span> <span class="token punctuation">{</span>predict<span class="token punctuation">(</span>model<span class="token punctuation">,</span> newdata <span class="token operator">=</span> test_data<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    predictions.weighted <span class="token operator">&lt;-</span> apply<span class="token punctuation">(</span>predicted.labels<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword keyword-function">function</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span> weighted.mean<span class="token punctuation">(</span>as.numeric<span class="token punctuation">(</span>row<span class="token punctuation">)</span><span class="token punctuation">,</span> w <span class="token operator">=</span> svm_weights<span class="token punctuation">)</span><span class="token punctuation">)</span>
    predicted_labels <span class="token operator">&lt;-</span> ifelse<span class="token punctuation">(</span>predictions.weighted <span class="token operator">&gt;</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token comment"># final_predictions &lt;- apply(predicted_labels, 1, function(row) ifelse(sum(row == 1) &gt; sum(row == 0), 1, 0))</span>
  
    accuracy <span class="token operator">&lt;-</span> mean<span class="token punctuation">(</span>predicted_labels <span class="token operator">==</span> test_y<span class="token punctuation">)</span>
    cv_results <span class="token operator">&lt;-</span> rbind<span class="token punctuation">(</span>cv_results<span class="token punctuation">,</span> data.frame<span class="token punctuation">(</span>accuracy <span class="token operator">=</span> accuracy<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment"># Calculate the mean accuracy over the 5 folds</span>
accuracy.svm.bagged <span class="token operator">&lt;-</span> mean<span class="token punctuation">(</span>cv_results<span class="token operator">$</span>accuracy<span class="token punctuation">)</span>
accuracy.svm.bagged
<span class="token comment"># 0.693965</span>
</code></pre><p>after implementing this simple bagging svm, tweaking parameters seem having little effect on the cross validation result. The SVM methodology seems to reach a limit.</p>
<h4 id="bagged-linear-logistic-model">Bagged: linear logistic model </h4>
<p>Using the bagging code at SVM section on the linear logistic model.</p>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code>set.seed<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>
num_models <span class="token operator">&lt;-</span> <span class="token number">1000</span>
feature_size <span class="token operator">&lt;-</span> <span class="token number">5</span>
sample_size <span class="token operator">&lt;-</span> nrow<span class="token punctuation">(</span>data.scaled<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">10</span>
cv_results <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>accuracy <span class="token operator">=</span> numeric<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># Perform 5-fold cross-validation</span>
folds <span class="token operator">&lt;-</span> createFolds<span class="token punctuation">(</span>data.y<span class="token punctuation">,</span> k <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">)</span>
<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>fold <span class="token keyword keyword-in">in</span> folds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    train_data <span class="token operator">&lt;-</span> data.scaled<span class="token punctuation">[</span><span class="token operator">-</span>fold<span class="token punctuation">,</span> <span class="token punctuation">]</span>
    test_data <span class="token operator">&lt;-</span> data.scaled<span class="token punctuation">[</span>fold<span class="token punctuation">,</span> <span class="token punctuation">]</span>
    train_y <span class="token operator">&lt;-</span> data.y<span class="token punctuation">[</span><span class="token operator">-</span>fold<span class="token punctuation">]</span>
    test_y <span class="token operator">&lt;-</span> data.y<span class="token punctuation">[</span>fold<span class="token punctuation">]</span>

    trimmed_indices <span class="token operator">&lt;-</span> intersect<span class="token punctuation">(</span>fold<span class="token punctuation">,</span> outlier_indices<span class="token punctuation">)</span>
    train_data <span class="token operator">&lt;-</span> train_data<span class="token punctuation">[</span><span class="token operator">-</span>trimmed_indices<span class="token punctuation">,</span> <span class="token punctuation">]</span>
    train_y <span class="token operator">&lt;-</span> train_y<span class="token punctuation">[</span><span class="token operator">-</span>trimmed_indices<span class="token punctuation">]</span>

    logistic_models <span class="token operator">&lt;-</span> list<span class="token punctuation">(</span><span class="token punctuation">)</span>
    weights <span class="token operator">&lt;-</span> numeric<span class="token punctuation">(</span>num_models<span class="token punctuation">)</span>

    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>i <span class="token keyword keyword-in">in</span> <span class="token number">1</span><span class="token operator">:</span>num_models<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        n <span class="token operator">&lt;-</span> nrow<span class="token punctuation">(</span>train_data<span class="token punctuation">)</span>
        sample_indices <span class="token operator">&lt;-</span> sample<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span>n<span class="token punctuation">,</span> size <span class="token operator">=</span> sample_size<span class="token punctuation">,</span> replace <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span>
        sampled_train_data <span class="token operator">&lt;-</span> train_data<span class="token punctuation">[</span>sample_indices<span class="token punctuation">,</span> <span class="token punctuation">]</span>
        sampled_train_y <span class="token operator">&lt;-</span> train_y<span class="token punctuation">[</span>sample_indices<span class="token punctuation">]</span>
        
        n <span class="token operator">&lt;-</span> ncol<span class="token punctuation">(</span>sampled_train_data<span class="token punctuation">)</span>
        variables.index <span class="token operator">&lt;-</span> sample<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span>n<span class="token punctuation">,</span> size <span class="token operator">=</span> feature_size<span class="token punctuation">)</span>
        variables.selected <span class="token operator">&lt;-</span> names<span class="token punctuation">(</span>sampled_train_data<span class="token punctuation">)</span><span class="token punctuation">[</span>variables.index<span class="token punctuation">]</span>
        sampled_train_data <span class="token operator">&lt;-</span> sampled_train_data<span class="token punctuation">[</span><span class="token punctuation">,</span> variables.selected<span class="token punctuation">]</span>
        <span class="token comment"># family = sample(c('binomial', 'gaussian'), 1)</span>

        model <span class="token operator">&lt;-</span> glm<span class="token punctuation">(</span>formula <span class="token operator">=</span> sampled_train_y <span class="token operator">~</span> .<span class="token punctuation">,</span> data <span class="token operator">=</span> sampled_train_data<span class="token punctuation">,</span> family <span class="token operator">=</span> <span class="token string">'binomial'</span><span class="token punctuation">)</span>
        pruning <span class="token operator">&lt;-</span> stepAIC<span class="token punctuation">(</span>model<span class="token punctuation">,</span> trace <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span>        
        model <span class="token operator">&lt;-</span> glm<span class="token punctuation">(</span>formula <span class="token operator">=</span> pruning<span class="token operator">$</span>formula<span class="token punctuation">,</span> data <span class="token operator">=</span> sampled_train_data<span class="token punctuation">,</span> family <span class="token operator">=</span> <span class="token string">'binomial'</span><span class="token punctuation">)</span>

        info_gain <span class="token operator">&lt;-</span> mean<span class="token punctuation">(</span>ifelse<span class="token punctuation">(</span>predict<span class="token punctuation">(</span>model<span class="token punctuation">,</span> sampled_train_data<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">==</span> sampled_train_y<span class="token punctuation">)</span> <span class="token operator">-</span> mean<span class="token punctuation">(</span>sampled_train_y<span class="token punctuation">)</span>
        weight <span class="token operator">&lt;-</span> max<span class="token punctuation">(</span><span class="token punctuation">(</span>info_gain <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token operator">^</span><span class="token number">2</span> <span class="token punctuation">,</span> <span class="token number">0.001</span><span class="token punctuation">)</span>

        logistic_models<span class="token punctuation">[</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&lt;-</span> model
        weights<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;-</span> weight
        print<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    predicted.labels <span class="token operator">&lt;-</span> sapply<span class="token punctuation">(</span>logistic_models<span class="token punctuation">,</span> <span class="token keyword keyword-function">function</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span> <span class="token punctuation">{</span>predict<span class="token punctuation">(</span>model<span class="token punctuation">,</span> newdata <span class="token operator">=</span> test_data<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    predictions.weighted <span class="token operator">&lt;-</span> apply<span class="token punctuation">(</span>predicted.labels<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword keyword-function">function</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span> weighted.mean<span class="token punctuation">(</span>as.numeric<span class="token punctuation">(</span>row<span class="token punctuation">)</span><span class="token punctuation">,</span> w <span class="token operator">=</span> weights<span class="token punctuation">)</span><span class="token punctuation">)</span>
    predicted_labels <span class="token operator">&lt;-</span> ifelse<span class="token punctuation">(</span>predictions.weighted <span class="token operator">&gt;</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  
    accuracy <span class="token operator">&lt;-</span> mean<span class="token punctuation">(</span>predicted_labels <span class="token operator">==</span> test_y<span class="token punctuation">)</span>
    cv_results <span class="token operator">&lt;-</span> rbind<span class="token punctuation">(</span>cv_results<span class="token punctuation">,</span> data.frame<span class="token punctuation">(</span>accuracy <span class="token operator">=</span> accuracy<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment"># Calculate the mean accuracy over the 5 folds</span>
accuracy.logistic.bagged <span class="token operator">&lt;-</span> mean<span class="token punctuation">(</span>cv_results<span class="token operator">$</span>accuracy<span class="token punctuation">)</span>
accuracy.logistic.bagged
<span class="token comment"># 0.7110622</span>
</code></pre><h4 id="summary">Summary </h4>
<p>Cross valuation accuracy is nearly not difference comparing to the baseline, no good.</p>
<p>Above all, the random forest is so far the best model.</p>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code>acc <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>accuracy.naive<span class="token punctuation">,</span> accuracy.linear<span class="token punctuation">,</span> accuracy.logistic<span class="token punctuation">,</span> accuracy.logistic.trimmed<span class="token punctuation">,</span> 
                    accuracy.qda<span class="token punctuation">,</span> accuracy.rf<span class="token punctuation">,</span> accuracy.svm<span class="token punctuation">,</span> accuracy.svm.bagged<span class="token punctuation">,</span> accuracy.logistic.bagged<span class="token punctuation">,</span> accuracy.knn<span class="token punctuation">)</span>
acc <span class="token operator">&lt;-</span> t<span class="token punctuation">(</span>acc<span class="token punctuation">)</span>
colnames<span class="token punctuation">(</span>acc<span class="token punctuation">)</span> <span class="token operator">&lt;-</span> <span class="token string">'accuracy'</span>
acc
</code></pre><table>
<thead>
<tr>
<th style="text-align:left"></th>
<th style="text-align:right">accuracy</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">accuracy.naive</td>
<td style="text-align:right">0.6935337</td>
</tr>
<tr>
<td style="text-align:left">accuracy.linear</td>
<td style="text-align:right">0.6946701</td>
</tr>
<tr>
<td style="text-align:left">accuracy.logistic</td>
<td style="text-align:right">0.6964911</td>
</tr>
<tr>
<td style="text-align:left">accuracy.logistic.trimmed</td>
<td style="text-align:right">0.6996740</td>
</tr>
<tr>
<td style="text-align:left">accuracy.qda</td>
<td style="text-align:right">0.6942151</td>
</tr>
<tr>
<td style="text-align:left">accuracy.rf</td>
<td style="text-align:right">0.7151700</td>
</tr>
<tr>
<td style="text-align:left">accuracy.svm</td>
<td style="text-align:right">0.6919377</td>
</tr>
<tr>
<td style="text-align:left">accuracy.svm.bagged</td>
<td style="text-align:right">0.6937592</td>
</tr>
<tr>
<td style="text-align:left">accuracy.logistic.bagged</td>
<td style="text-align:right">0.7110622</td>
</tr>
<tr>
<td style="text-align:left">accuracy.knn</td>
<td style="text-align:right">0.6958049</td>
</tr>
</tbody>
</table>
<p>as we can see:</p>
<ul>
<li>models with bagging strategy usually do better in this task</li>
<li>models with linear modeling can not handle data effectively (strong non-linear features)</li>
<li>we prefer a <strong>random forest</strong> model in this case
<ul>
<li>better suitable for non-linear tasks</li>
<li>good metrics</li>
<li>less sensitive to individual observation (outliers)</li>
</ul>
</li>
</ul>
<h2 id="4b">4.b </h2>
<p>In this part, we will farther tweak this random forest model to its full potential.</p>
<h3 id="0-features-of-the-data">0. Features of the Data </h3>
<p>&lt;--- todo: Wang Ping, analysis and some graph  ---&gt;</p>
<h3 id="1-noise-handling">1. Noise Handling </h3>
<p>The outlier having heavy penalty on our selected model, one way to counter the effect is to map the data into an ordinal space.</p>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code>data.extended.rank <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>row.names <span class="token operator">=</span> row.names<span class="token punctuation">(</span>data.scaled<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>col_name <span class="token keyword keyword-in">in</span> names<span class="token punctuation">(</span>data.scaled<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    data.extended.rank<span class="token punctuation">[</span>paste<span class="token punctuation">(</span>col_name<span class="token punctuation">,</span> <span class="token string">'_rank'</span><span class="token punctuation">,</span> sep <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">&lt;-</span> rank<span class="token punctuation">(</span>data.scaled<span class="token punctuation">[</span>col_name<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> nrow<span class="token punctuation">(</span>data.scaled<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="2-non-linear-features">2. Non-linear Features </h3>
<p>As we demonstrated above, the task is high non-linear in nature. We propose a polynomial solution</p>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code>polynomial_features <span class="token operator">&lt;-</span> <span class="token keyword keyword-function">function</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> degree<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    var_names <span class="token operator">&lt;-</span> names<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    
    extended.names <span class="token operator">&lt;-</span> lapply<span class="token punctuation">(</span>var_names<span class="token punctuation">,</span> <span class="token keyword keyword-function">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> list<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>i <span class="token keyword keyword-in">in</span> <span class="token number">2</span><span class="token operator">:</span>degree<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        extended_orders <span class="token operator">&lt;-</span> list<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>new_term <span class="token keyword keyword-in">in</span> var_names<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            t <span class="token operator">&lt;-</span> lapply<span class="token punctuation">(</span>extended.names<span class="token punctuation">,</span> <span class="token keyword keyword-function">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> append<span class="token punctuation">(</span>x<span class="token punctuation">,</span> new_term<span class="token punctuation">)</span><span class="token punctuation">)</span>
            extended_orders <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span>extended_orders<span class="token punctuation">,</span> t<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        extended.names <span class="token operator">&lt;-</span> unique<span class="token punctuation">(</span>lapply<span class="token punctuation">(</span>extended_orders<span class="token punctuation">,</span> <span class="token keyword keyword-function">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> paste<span class="token punctuation">(</span>sort<span class="token punctuation">(</span>unlist<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> collapse <span class="token operator">=</span> <span class="token string">"__"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  
    data.extended.poly <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>row.names <span class="token operator">=</span> row.names<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>var_name <span class="token keyword keyword-in">in</span> extended.names<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        var_name <span class="token operator">&lt;-</span> var_name<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
        features <span class="token operator">&lt;-</span> strsplit<span class="token punctuation">(</span>var_name<span class="token punctuation">,</span> <span class="token string">"__"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
        data.extended.poly<span class="token punctuation">[</span>var_name<span class="token punctuation">]</span> <span class="token operator">&lt;-</span> apply<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token punctuation">,</span> features<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword keyword-function">function</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span> prod<span class="token punctuation">(</span>row<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    return<span class="token punctuation">(</span>data.extended.poly<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><pre data-role="codeBlock" data-info="R" class="language-r R"><code>data.extended.scaled.poly <span class="token operator">&lt;-</span> polynomial_features<span class="token punctuation">(</span>data.scaled<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
data.extended.rank.poly <span class="token operator">&lt;-</span> polynomial_features<span class="token punctuation">(</span>data.extended.rank<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
</code></pre><p>We extended the features using poly polynomial expansion. Higher degree of poly is not computational feasible using my laptop.</p>
<h3 id="3-fitting">3. Fitting </h3>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code>set.seed<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>
cv_results <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>accuracy <span class="token operator">=</span> numeric<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
data.training <span class="token operator">&lt;-</span> cbind<span class="token punctuation">(</span>data.scaled<span class="token punctuation">,</span> data.extended.scaled.poly<span class="token punctuation">,</span> data.extended.rank.poly<span class="token punctuation">)</span>

<span class="token comment"># Perform 5-fold cross-validation</span>
folds <span class="token operator">&lt;-</span> createFolds<span class="token punctuation">(</span>data.y<span class="token punctuation">,</span> k <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">)</span>
<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>fold <span class="token keyword keyword-in">in</span> folds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    train_data <span class="token operator">&lt;-</span> data.training<span class="token punctuation">[</span><span class="token operator">-</span>fold<span class="token punctuation">,</span> <span class="token punctuation">]</span>
    test_data <span class="token operator">&lt;-</span> data.training<span class="token punctuation">[</span>fold<span class="token punctuation">,</span> <span class="token punctuation">]</span>
    train_y <span class="token operator">&lt;-</span> data.y<span class="token punctuation">[</span><span class="token operator">-</span>fold<span class="token punctuation">]</span>
    test_y <span class="token operator">&lt;-</span> data.y<span class="token punctuation">[</span>fold<span class="token punctuation">]</span>
    
    model <span class="token operator">&lt;-</span> randomForest<span class="token punctuation">(</span>as.factor<span class="token punctuation">(</span>train_y<span class="token punctuation">)</span> <span class="token operator">~</span> .<span class="token punctuation">,</span> data <span class="token operator">=</span> train_data<span class="token punctuation">,</span> mtry<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> ntree <span class="token operator">=</span> <span class="token number">5000</span><span class="token punctuation">)</span>
    
    predicted_labels <span class="token operator">&lt;-</span> predict<span class="token punctuation">(</span>model<span class="token punctuation">,</span> newdata <span class="token operator">=</span> test_data<span class="token punctuation">)</span>
    accuracy <span class="token operator">&lt;-</span> mean<span class="token punctuation">(</span>predicted_labels <span class="token operator">==</span> as.factor<span class="token punctuation">(</span>test_y<span class="token punctuation">)</span><span class="token punctuation">)</span>
    cv_results <span class="token operator">&lt;-</span> rbind<span class="token punctuation">(</span>cv_results<span class="token punctuation">,</span> data.frame<span class="token punctuation">(</span>accuracy <span class="token operator">=</span> accuracy<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment"># Calculate the mean accuracy over the 5 folds</span>
accuracy.rf.extended <span class="token operator">&lt;-</span> mean<span class="token punctuation">(</span>cv_results<span class="token operator">$</span>accuracy<span class="token punctuation">)</span>
accuracy.rf.extended
<span class="token comment"># 0.7204042</span>
</code></pre><p>As you can see, we easily boosted the model, almost double the accuracy gain.</p>
<ul>
<li>We did not include the <code>data.extended.rank</code>, it is equivalent to <code>data.extended.scaled</code> in this model</li>
<li>However the poly expansion of ranking data is not equivalent (less noise)</li>
<li>The training parameter suggest that we did not reach the limit of this model. (Not optimal parameters)
<ul>
<li>total of 195 features</li>
<li>selecting 10 features (under selecting)</li>
<li>building 5000 trees (under sampling)</li>
</ul>
</li>
<li>However this is as far as my laptop can go.</li>
<li>Besides the correlation of the features are strong, under-fitting issue is not that big.</li>
<li>The result is so far the best.</li>
</ul>
<h3 id="4-optional-augmentation">4. Optional: Augmentation </h3>
<p>As we demonstrated above in the previous section, the random forest is severely over-fitting. A simple augmentation is implemented to address this issue.</p>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code>augmented_noise <span class="token operator">&lt;-</span> <span class="token keyword keyword-function">function</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> scale <span class="token operator">=</span> <span class="token number">0.1</span><span class="token punctuation">,</span> multiplier <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    augmented_data <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>i <span class="token keyword keyword-in">in</span> <span class="token number">1</span><span class="token operator">:</span>multiplier<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    noise <span class="token operator">&lt;-</span> scale <span class="token operator">*</span> matrix<span class="token punctuation">(</span>rnorm<span class="token punctuation">(</span>n <span class="token operator">=</span> nrow<span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">*</span> ncol<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nrow <span class="token operator">=</span> nrow<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
    augmented_data <span class="token operator">&lt;-</span> rbind<span class="token punctuation">(</span>augmented_data<span class="token punctuation">,</span> data <span class="token operator">+</span> noise<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    return<span class="token punctuation">(</span>augmented_data<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><p>Note that the <code>data.scaled</code> and <code>data.extended.rank</code> is already standardized, this is safe to use this augmentation procedure.</p>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code>data.augmented.scaled <span class="token operator">&lt;-</span> augmented_noise<span class="token punctuation">(</span>data.scaled<span class="token punctuation">,</span> scale <span class="token operator">=</span> <span class="token number">0.1</span><span class="token punctuation">,</span> multiplier <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">)</span>
data.augmented.rank <span class="token operator">&lt;-</span> augmented_noise<span class="token punctuation">(</span>data.extended.rank<span class="token punctuation">,</span> scale <span class="token operator">=</span> <span class="token number">0.05</span><span class="token punctuation">,</span> multiplier <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">)</span>
data.augmented.scaled.poly <span class="token operator">&lt;-</span> polynomial_features<span class="token punctuation">(</span>data.augmented.scaled<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
data.augmented.rank.poly <span class="token operator">&lt;-</span> polynomial_features<span class="token punctuation">(</span>data.augmented.rank<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
data.training <span class="token operator">&lt;-</span> cbind<span class="token punctuation">(</span>data.augmented.scaled<span class="token punctuation">,</span> data.augmented.scaled.poly<span class="token punctuation">,</span> data.augmented.rank.poly<span class="token punctuation">)</span>
data.augmented.y <span class="token operator">&lt;-</span> rep<span class="token punctuation">(</span>data.y<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
</code></pre><p>Test the model, fitted with augmented data on the original ones.</p>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code>fit.rf <span class="token operator">&lt;-</span> randomForest<span class="token punctuation">(</span>as.factor<span class="token punctuation">(</span>data.augmented.y<span class="token punctuation">)</span> <span class="token operator">~</span> .<span class="token punctuation">,</span> data <span class="token operator">=</span> data.training<span class="token punctuation">,</span> mtry<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> ntree <span class="token operator">=</span> <span class="token number">5000</span><span class="token punctuation">)</span>

data.extended.rank.poly <span class="token operator">&lt;-</span> polynomial_features<span class="token punctuation">(</span>data.extended.rank<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
data.scaled.poly <span class="token operator">&lt;-</span> polynomial_features<span class="token punctuation">(</span>data.scaled<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
data.batch <span class="token operator">&lt;-</span> cbind<span class="token punctuation">(</span>data.scaled<span class="token punctuation">,</span> data.scaled.poly<span class="token punctuation">,</span> data.extended.rank.poly<span class="token punctuation">)</span>

mean<span class="token punctuation">(</span>predict<span class="token punctuation">(</span>fit.rf<span class="token punctuation">,</span> data.batch<span class="token punctuation">)</span> <span class="token operator">==</span> as.factor<span class="token punctuation">(</span>data.y<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 0.9521858</span>
</code></pre><p>As we can see, we use only the augmented data (no original one), to fit the model, and perform an "out-of-sample" test. The result is good, suggesting a good fit and valid augmentation.</p>
<p>Do the 5-fold cross validation again</p>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code>set.seed<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>
cv_results <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>accuracy <span class="token operator">=</span> numeric<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># Perform 5-fold cross-validation</span>
folds <span class="token operator">&lt;-</span> createFolds<span class="token punctuation">(</span>data.y<span class="token punctuation">,</span> k <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">)</span>
<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>fold <span class="token keyword keyword-in">in</span> folds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    train.x <span class="token operator">&lt;-</span> data.scaled<span class="token punctuation">[</span><span class="token operator">-</span>fold<span class="token punctuation">,</span> <span class="token punctuation">]</span>
    test.x <span class="token operator">&lt;-</span> data.scaled<span class="token punctuation">[</span>fold<span class="token punctuation">,</span> <span class="token punctuation">]</span>
    train.y <span class="token operator">&lt;-</span> data.y<span class="token punctuation">[</span><span class="token operator">-</span>fold<span class="token punctuation">]</span>
    test.y <span class="token operator">&lt;-</span> data.y<span class="token punctuation">[</span>fold<span class="token punctuation">]</span>

    train.x.rank <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>row.names <span class="token operator">=</span> row.names<span class="token punctuation">(</span>train.x<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>col_name <span class="token keyword keyword-in">in</span> names<span class="token punctuation">(</span>train.x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        train.x.rank<span class="token punctuation">[</span>paste<span class="token punctuation">(</span>col_name<span class="token punctuation">,</span> <span class="token string">'_rank'</span><span class="token punctuation">,</span> sep <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">&lt;-</span> rank<span class="token punctuation">(</span>train.x<span class="token punctuation">[</span>col_name<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> nrow<span class="token punctuation">(</span>train.x<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    train.x.augmented <span class="token operator">&lt;-</span> augmented_noise<span class="token punctuation">(</span>train.x<span class="token punctuation">,</span> scale <span class="token operator">=</span> <span class="token number">0.2</span><span class="token punctuation">,</span> multiplier <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">)</span>
    train.x.rank.augmented <span class="token operator">&lt;-</span> augmented_noise<span class="token punctuation">(</span>train.x.rank<span class="token punctuation">,</span> scale <span class="token operator">=</span> <span class="token number">0.1</span><span class="token punctuation">,</span> multiplier <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">)</span>

    train.x.augmented.poly <span class="token operator">&lt;-</span> polynomial_features<span class="token punctuation">(</span>train.x.augmented<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
    train.x.rank.augmented.poly <span class="token operator">&lt;-</span> polynomial_features<span class="token punctuation">(</span>train.x.rank.augmented<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>

    train.x.batch <span class="token operator">&lt;-</span> cbind<span class="token punctuation">(</span>train.x.augmented<span class="token punctuation">,</span> train.x.augmented.poly<span class="token punctuation">,</span> train.x.rank.augmented.poly<span class="token punctuation">)</span>
    train.y <span class="token operator">&lt;-</span> rep<span class="token punctuation">(</span>train.y<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>

    model <span class="token operator">&lt;-</span> randomForest<span class="token punctuation">(</span>as.factor<span class="token punctuation">(</span>train.y<span class="token punctuation">)</span> <span class="token operator">~</span> .<span class="token punctuation">,</span> data <span class="token operator">=</span> train.x.batch<span class="token punctuation">,</span> mtry<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> ntree <span class="token operator">=</span> <span class="token number">2000</span><span class="token punctuation">)</span>
    
    test.x.rank <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>row.names <span class="token operator">=</span> row.names<span class="token punctuation">(</span>test.x<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>col_name <span class="token keyword keyword-in">in</span> names<span class="token punctuation">(</span>test.x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        test.x.rank<span class="token punctuation">[</span>paste<span class="token punctuation">(</span>col_name<span class="token punctuation">,</span> <span class="token string">'_rank'</span><span class="token punctuation">,</span> sep <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">&lt;-</span> rank<span class="token punctuation">(</span>test.x<span class="token punctuation">[</span>col_name<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> nrow<span class="token punctuation">(</span>test.x<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    test.x.poly <span class="token operator">&lt;-</span> polynomial_features<span class="token punctuation">(</span>test.x<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
    test.x.rank.poly <span class="token operator">&lt;-</span> polynomial_features<span class="token punctuation">(</span>test.x.rank<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>

    test.x.batch <span class="token operator">&lt;-</span> cbind<span class="token punctuation">(</span>test.x<span class="token punctuation">,</span> test.x.poly<span class="token punctuation">,</span> test.x.rank.poly<span class="token punctuation">)</span>

    predicted_labels <span class="token operator">&lt;-</span> predict<span class="token punctuation">(</span>model<span class="token punctuation">,</span> newdata <span class="token operator">=</span> test.x.batch<span class="token punctuation">)</span>
    accuracy <span class="token operator">&lt;-</span> mean<span class="token punctuation">(</span>predicted_labels <span class="token operator">==</span> as.factor<span class="token punctuation">(</span>test.y<span class="token punctuation">)</span><span class="token punctuation">)</span>
    cv_results <span class="token operator">&lt;-</span> rbind<span class="token punctuation">(</span>cv_results<span class="token punctuation">,</span> data.frame<span class="token punctuation">(</span>accuracy <span class="token operator">=</span> accuracy<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment"># Calculate the mean accuracy over the 5 folds</span>
accuracy.rf.augmented <span class="token operator">&lt;-</span> mean<span class="token punctuation">(</span>cv_results<span class="token operator">$</span>accuracy<span class="token punctuation">)</span>
accuracy.rf.augmented
<span class="token comment"># 0.71517</span>
</code></pre><h2 id="4c">4.c </h2>
<p>The Best model in 4.a only provide 71.5% accuracy, giving a very marginal effect. This is not enough for any investment strategy / decision.</p>
<p>Some possible solution:</p>
<ul>
<li>more complex model: this highly non-linear task requires more sophisticated model.</li>
<li>add more features / observations: which bring more information into the model.</li>
<li>sub set: divide the task into different group,
<ul>
<li>say high market_cap stock group and low market_cap group</li>
<li>or using other criteria</li>
<li>build model on each group to improve performance</li>
<li>this is basically to trade generalization capacity to a better fit.</li>
</ul>
</li>
</ul>
<h1 id="appendix">Appendix </h1>
<p>Full code block</p>
<pre data-role="codeBlock" data-info="R" class="language-r R"><code>trim_percent <span class="token operator">&lt;-</span> <span class="token number">0.1</span>
data.original <span class="token operator">&lt;-</span>  subset<span class="token punctuation">(</span>Stock_2018<span class="token punctuation">,</span> select <span class="token operator">=</span> <span class="token operator">-</span>y<span class="token punctuation">)</span>
data.y <span class="token operator">&lt;-</span> Stock_2018<span class="token operator">$</span>y

trim_limit_bottom <span class="token operator">&lt;-</span> trim_percent <span class="token operator">/</span> <span class="token number">2</span>
trim_limit_top <span class="token operator">&lt;-</span> <span class="token number">1</span> <span class="token operator">-</span> <span class="token punctuation">(</span>trim_percent <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>
statistics.trimmed <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>col_name <span class="token keyword keyword-in">in</span> names<span class="token punctuation">(</span>data.original<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>is.numeric<span class="token punctuation">(</span>data.original<span class="token punctuation">[</span><span class="token punctuation">[</span>col_name<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        trimmed_data <span class="token operator">&lt;-</span> data.original<span class="token punctuation">[</span><span class="token punctuation">[</span>col_name<span class="token punctuation">]</span><span class="token punctuation">]</span>
        trimmed_data <span class="token operator">&lt;-</span> trimmed_data<span class="token punctuation">[</span><span class="token operator">!</span>is.na<span class="token punctuation">(</span>trimmed_data<span class="token punctuation">)</span><span class="token punctuation">]</span>
        trimmed_data <span class="token operator">&lt;-</span> quantile<span class="token punctuation">(</span>trimmed_data<span class="token punctuation">,</span> c<span class="token punctuation">(</span>trim_limit_bottom<span class="token punctuation">,</span> trim_limit_top<span class="token punctuation">)</span><span class="token punctuation">)</span>
        trimmed_data <span class="token operator">&lt;-</span> data.original<span class="token punctuation">[</span><span class="token punctuation">[</span>col_name<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span>data.original<span class="token punctuation">[</span><span class="token punctuation">[</span>col_name<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> trimmed_data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> data.original<span class="token punctuation">[</span><span class="token punctuation">[</span>col_name<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> trimmed_data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
        
        col_statistics <span class="token operator">&lt;-</span> list<span class="token punctuation">(</span>
            variable <span class="token operator">=</span> col_name<span class="token punctuation">,</span>
            mean <span class="token operator">=</span> mean<span class="token punctuation">(</span>trimmed_data<span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            sd <span class="token operator">=</span> sd<span class="token punctuation">(</span>trimmed_data<span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            P0 <span class="token operator">=</span> quantile<span class="token punctuation">(</span>trimmed_data<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            P25 <span class="token operator">=</span> quantile<span class="token punctuation">(</span>trimmed_data<span class="token punctuation">,</span> <span class="token number">0.25</span><span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            P50 <span class="token operator">=</span> quantile<span class="token punctuation">(</span>trimmed_data<span class="token punctuation">,</span> <span class="token number">0.50</span><span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            P75 <span class="token operator">=</span> quantile<span class="token punctuation">(</span>trimmed_data<span class="token punctuation">,</span> <span class="token number">0.75</span><span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            P100 <span class="token operator">=</span> quantile<span class="token punctuation">(</span>trimmed_data<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
        
        statistics.trimmed <span class="token operator">&lt;-</span> rbind<span class="token punctuation">(</span>statistics.trimmed<span class="token punctuation">,</span> col_statistics<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

data.scaled <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>row.names <span class="token operator">=</span> row.names<span class="token punctuation">(</span>data.original<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>col_name <span class="token keyword keyword-in">in</span> names<span class="token punctuation">(</span>data.original<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment"># Check if the column is numeric</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>col_name <span class="token percent-operator operator">%in%</span> statistics.trimmed<span class="token operator">$</span>variable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        col_data <span class="token operator">&lt;-</span> data.original<span class="token punctuation">[</span>col_name<span class="token punctuation">]</span>
        mean <span class="token operator">&lt;-</span> statistics.trimmed<span class="token punctuation">[</span>statistics.trimmed<span class="token operator">$</span>variable <span class="token operator">==</span> col_name<span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token operator">$</span>mean
        sd <span class="token operator">&lt;-</span> statistics.trimmed<span class="token punctuation">[</span>statistics.trimmed<span class="token operator">$</span>variable <span class="token operator">==</span> col_name<span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token operator">$</span>sd
        col_scaled <span class="token operator">&lt;-</span> <span class="token punctuation">(</span>col_data <span class="token operator">-</span> mean<span class="token punctuation">)</span> <span class="token operator">/</span> sd
        data.scaled<span class="token punctuation">[</span>col_name<span class="token punctuation">]</span> <span class="token operator">&lt;-</span> col_scaled
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

data.scaled<span class="token punctuation">[</span>is.na<span class="token punctuation">(</span>data.scaled<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">&lt;-</span> <span class="token number">0</span>
<span class="token comment"># some column name is using special characters, replace them</span>
colnames<span class="token punctuation">(</span>data.scaled<span class="token punctuation">)</span> <span class="token operator">&lt;-</span> gsub<span class="token punctuation">(</span><span class="token string">"&amp;"</span><span class="token punctuation">,</span> <span class="token string">"n"</span><span class="token punctuation">,</span> colnames<span class="token punctuation">(</span>data.scaled<span class="token punctuation">)</span><span class="token punctuation">)</span>
colnames<span class="token punctuation">(</span>data.scaled<span class="token punctuation">)</span> <span class="token operator">&lt;-</span> gsub<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span> <span class="token string">"_"</span><span class="token punctuation">,</span> colnames<span class="token punctuation">(</span>data.scaled<span class="token punctuation">)</span><span class="token punctuation">)</span>

data.extended.rank <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>row.names <span class="token operator">=</span> row.names<span class="token punctuation">(</span>data.scaled<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>col_name <span class="token keyword keyword-in">in</span> names<span class="token punctuation">(</span>data.scaled<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    data.extended.rank<span class="token punctuation">[</span>paste<span class="token punctuation">(</span>col_name<span class="token punctuation">,</span> <span class="token string">'_rank'</span><span class="token punctuation">,</span> sep <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">&lt;-</span> rank<span class="token punctuation">(</span>data.scaled<span class="token punctuation">[</span>col_name<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> nrow<span class="token punctuation">(</span>data.scaled<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

polynomial_features <span class="token operator">&lt;-</span> <span class="token keyword keyword-function">function</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> degree<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    var_names <span class="token operator">&lt;-</span> names<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    
    extended.names <span class="token operator">&lt;-</span> lapply<span class="token punctuation">(</span>var_names<span class="token punctuation">,</span> <span class="token keyword keyword-function">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> list<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>i <span class="token keyword keyword-in">in</span> <span class="token number">2</span><span class="token operator">:</span>degree<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        extended_orders <span class="token operator">&lt;-</span> list<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>new_term <span class="token keyword keyword-in">in</span> var_names<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            t <span class="token operator">&lt;-</span> lapply<span class="token punctuation">(</span>extended.names<span class="token punctuation">,</span> <span class="token keyword keyword-function">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> append<span class="token punctuation">(</span>x<span class="token punctuation">,</span> new_term<span class="token punctuation">)</span><span class="token punctuation">)</span>
            extended_orders <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span>extended_orders<span class="token punctuation">,</span> t<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        extended.names <span class="token operator">&lt;-</span> unique<span class="token punctuation">(</span>lapply<span class="token punctuation">(</span>extended_orders<span class="token punctuation">,</span> <span class="token keyword keyword-function">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> paste<span class="token punctuation">(</span>sort<span class="token punctuation">(</span>unlist<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> collapse <span class="token operator">=</span> <span class="token string">"__"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  
    data.extended.poly <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>row.names <span class="token operator">=</span> row.names<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>var_name <span class="token keyword keyword-in">in</span> extended.names<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        var_name <span class="token operator">&lt;-</span> var_name<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
        features <span class="token operator">&lt;-</span> strsplit<span class="token punctuation">(</span>var_name<span class="token punctuation">,</span> <span class="token string">"__"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
        data.extended.poly<span class="token punctuation">[</span>var_name<span class="token punctuation">]</span> <span class="token operator">&lt;-</span> apply<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token punctuation">,</span> features<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword keyword-function">function</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span> prod<span class="token punctuation">(</span>row<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    return<span class="token punctuation">(</span>data.extended.poly<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

augmented_noise <span class="token operator">&lt;-</span> <span class="token keyword keyword-function">function</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> scale <span class="token operator">=</span> <span class="token number">0.1</span><span class="token punctuation">,</span> multiplier <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    augmented_data <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>i <span class="token keyword keyword-in">in</span> <span class="token number">1</span><span class="token operator">:</span>multiplier<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    noise <span class="token operator">&lt;-</span> scale <span class="token operator">*</span> matrix<span class="token punctuation">(</span>rnorm<span class="token punctuation">(</span>n <span class="token operator">=</span> nrow<span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">*</span> ncol<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nrow <span class="token operator">=</span> nrow<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
    augmented_data <span class="token operator">&lt;-</span> rbind<span class="token punctuation">(</span>augmented_data<span class="token punctuation">,</span> data <span class="token operator">+</span> noise<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    return<span class="token punctuation">(</span>augmented_data<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

data.augmented.scaled <span class="token operator">&lt;-</span> augmented_noise<span class="token punctuation">(</span>data.scaled<span class="token punctuation">,</span> scale <span class="token operator">=</span> <span class="token number">0.1</span><span class="token punctuation">,</span> multiplier <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">)</span>
data.augmented.rank <span class="token operator">&lt;-</span> augmented_noise<span class="token punctuation">(</span>data.extended.rank<span class="token punctuation">,</span> scale <span class="token operator">=</span> <span class="token number">0.05</span><span class="token punctuation">,</span> multiplier <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">)</span>
data.augmented.scaled.poly <span class="token operator">&lt;-</span> polynomial_features<span class="token punctuation">(</span>data.augmented.scaled<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
data.augmented.rank.poly <span class="token operator">&lt;-</span> polynomial_features<span class="token punctuation">(</span>data.augmented.rank<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
data.training <span class="token operator">&lt;-</span> cbind<span class="token punctuation">(</span>data.augmented.scaled<span class="token punctuation">,</span> data.augmented.scaled.poly<span class="token punctuation">,</span> data.augmented.rank.poly<span class="token punctuation">)</span>
data.augmented.y <span class="token operator">&lt;-</span> rep<span class="token punctuation">(</span>data.y<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>

library<span class="token punctuation">(</span>randomForest<span class="token punctuation">)</span>

fit.rf <span class="token operator">&lt;-</span> randomForest<span class="token punctuation">(</span>as.factor<span class="token punctuation">(</span>data.augmented.y<span class="token punctuation">)</span> <span class="token operator">~</span> .<span class="token punctuation">,</span> data <span class="token operator">=</span> data.training<span class="token punctuation">,</span> mtry<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span> ntree <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">)</span>

data.extended.rank.poly <span class="token operator">&lt;-</span> polynomial_features<span class="token punctuation">(</span>data.extended.rank<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
data.scaled.poly <span class="token operator">&lt;-</span> polynomial_features<span class="token punctuation">(</span>data.scaled<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
data.batch <span class="token operator">&lt;-</span> cbind<span class="token punctuation">(</span>data.scaled<span class="token punctuation">,</span> data.scaled.poly<span class="token punctuation">,</span> data.extended.rank.poly<span class="token punctuation">)</span>

mean<span class="token punctuation">(</span>predict<span class="token punctuation">(</span>fit.rf<span class="token punctuation">,</span> data.batch<span class="token punctuation">)</span> <span class="token operator">==</span> as.factor<span class="token punctuation">(</span>data.y<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
      </div>
      
      
    
    
    
    
    
    
  
    </body></html>